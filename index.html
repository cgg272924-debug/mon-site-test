<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>OL Match Analyzer - Dashboard</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <link rel="stylesheet" href="styles.css?v=ol-theme-1">
</head>
<body>
    <header class="header">
        <nav class="navbar">
            <div class="nav-container">
                <div class="logo">
                    <span class="logo-icon">ü¶Å</span>
                    <span class="logo-text">OL Match Analyzer</span>
                </div>
                <ul class="nav-menu">
                    <li><a href="#home" class="nav-link active">Accueil</a></li>
                    <li><a href="#standings" class="nav-link">Classements</a></li>
                    <li><a href="#matches" class="nav-link">Matchs</a></li>
                    <li><a href="#mercato" class="nav-link">Mercato</a></li>
                    <li><a href="#news" class="nav-link">Actualit√©s</a></li>
                    <li><a href="#players" class="nav-link">Joueurs</a></li>
                    <li><a href="#lineups" class="nav-link">Compositions</a></li>
                    <li><a href="#styles" class="nav-link">Styles</a></li>
                    <li><a href="#match-analysis" class="nav-link">Analyse Match</a></li>
                    <li><a href="#stats" class="nav-link">Statistiques</a></li>
                </ul>
                <div class="hamburger">
                    <span></span>
                    <span></span>
                    <span></span>
                </div>
            </div>
        </nav>
    </header>

    <main>
        <section id="home" class="hero">
            <div class="hero-content">
                <h1 class="hero-title">
                    <span class="gradient-text">Analyse Avanc√©e</span>
                    <br>des Matchs OL
                </h1>
                <p class="text-sm text-gray-400 mt-1">Saison 2025‚Äì2026</p>
                <p class="hero-description">
                    D√©couvrez des insights d√©taill√©s sur les performances, les compositions d'√©quipe 
                    et l'impact des joueurs avec notre plateforme d'analyse de donn√©es.
                </p>
                <div class="hero-buttons">
                    <button class="btn btn-primary">Explorer les Donn√©es</button>
                    <button class="btn btn-secondary">Voir les Statistiques</button>
                </div>
            </div>
            <div class="hero-visual">
                <div class="floating-card card-1">
                    <div class="card-icon">üìä</div>
                    <div class="card-title">Analyse de Matchs</div>
                </div>
                <div class="floating-card card-2">
                    <div class="card-icon">üë•</div>
                    <div class="card-title">Impact des Joueurs</div>
                </div>
                <div class="floating-card card-3">
                    <div class="card-icon">üéØ</div>
                    <div class="card-title">Meilleures Combos</div>
                </div>
            </div>
        </section>

        <section class="stats-grid">
            <div class="stat-card">
                <div class="stat-icon">üèÜ</div>
                <div class="stat-content">
                    <h3 class="stat-value" id="hero-rank-value">--</h3>
                    <p class="stat-label" id="hero-rank-label">Classement Ligue 1</p>
                </div>
            </div>
            <div class="stat-card">
                <div class="stat-icon">ü¶Å</div>
                <div class="stat-content">
                    <h3 class="stat-value" id="hero-ol-rank-value">--</h3>
                    <p class="stat-label">Position OL</p>
                </div>
            </div>
            <div class="stat-card">
                <div class="stat-icon">‚öΩ</div>
                <div class="stat-content">
                    <h3 class="stat-value" id="hero-matches-value">--</h3>
                    <p class="stat-label">Matchs Analys√©s</p>
                </div>
            </div>
            <div class="stat-card">
                <div class="stat-icon">‚≠ê</div>
                <div class="stat-content">
                    <h3 class="stat-value" id="hero-rating-value">--</h3>
                    <p class="stat-label">Points OL</p>
                </div>
            </div>
            <div class="stat-card">
                <div class="stat-icon">üî•</div>
                <div class="stat-content">
                    <h3 class="stat-value" id="hero-combos-value">--</h3>
                    <p class="stat-label">Combos Optimales</p>
                </div>
            </div>
        </section>

        <section id="react-dashboard" class="section-content">
            <div class="container">
                <h2 class="section-title">R√©sum√© React des Performances</h2>
                <div id="react-root"></div>
            </div>
        </section>

        <section class="features">
            <h2 class="section-title">Fonctionnalit√©s Principales</h2>
            <div class="features-grid">
                <div class="feature-card">
                    <div class="feature-icon">üìà</div>
                    <h3 class="feature-title">Analyse de Performance</h3>
                    <p class="feature-description">
                        √âvaluation d√©taill√©e des performances de chaque match avec des m√©triques avanc√©es 
                        et des visualisations claires.
                    </p>
                </div>
                <div class="feature-card">
                    <div class="feature-icon">üë§</div>
                    <h3 class="feature-title">Impact des Joueurs</h3>
                    <p class="feature-description">
                        Mesurez l'impact individuel de chaque joueur sur les r√©sultats de l'√©quipe 
                        avec des analyses pr√©cises.
                    </p>
                </div>
                <div class="feature-card">
                    <div class="feature-icon">üîÑ</div>
                    <h3 class="feature-title">Combinaisons Optimales</h3>
                    <p class="feature-description">
                        D√©couvrez les meilleures combinaisons de joueurs pour maximiser les performances 
                        de l'√©quipe.
                    </p>
                </div>
                <div class="feature-card">
                    <div class="feature-icon">üìã</div>
                    <h3 class="feature-title">Gestion des Compositions</h3>
                    <p class="feature-description">
                        Analysez l'impact des diff√©rentes compositions d'√©quipe et optimisez vos choix 
                        tactiques.
                    </p>
                </div>
                <div class="feature-card">
                    <div class="feature-icon">üìä</div>
                    <h3 class="feature-title">Statistiques D√©taill√©es</h3>
                    <p class="feature-description">
                        Acc√©dez √† des statistiques compl√®tes sur les matchs, les joueurs et les √©quipes 
                        avec des tableaux interactifs.
                    </p>
                </div>
                <div class="feature-card">
                    <div class="feature-icon">üéØ</div>
                    <h3 class="feature-title">Pr√©dictions de Victoire</h3>
                    <p class="feature-description">
                        Estimez les probabilit√©s de victoire bas√©es sur les donn√©es historiques et 
                        les performances pass√©es.
                    </p>
                </div>
            </div>
        </section>

        <section class="data-preview">
            <h2 class="section-title">Aper√ßu des Donn√©es</h2>
            <div class="preview-container">
                <div class="preview-card">
                    <h3>Matchs R√©cents</h3>
                    <div class="table-container">
                        <table>
                            <thead>
                                <tr>
                                    <th>Date</th>
                                    <th>Adversaire</th>
                                    <th>R√©sultat</th>
                                    <th>Note</th>
                                </tr>
                            </thead>
                            <tbody id="preview-matches-tbody">
                                <tr>
                                    <td colspan="4" class="loading">Chargement des donn√©es...</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </section>

        <!-- Section Classements -->
        <section id="standings" class="section-content">
            <div class="container">
                <h2 class="section-title">Classement Ligue 1</h2>
                <div id="standings-react-root" class="mb-6"></div>
                
                <!-- Tabs pour basculer entre G√©n√©ral, Domicile, Ext√©rieur -->
                <div class="standings-tabs">
                    <button class="tab-btn active" data-tab="general">G√©n√©ral</button>
                    <button class="tab-btn" data-tab="home">Domicile</button>
                    <button class="tab-btn" data-tab="away">Ext√©rieur</button>
                </div>

                <!-- Tableau G√©n√©ral -->
                <div id="standings-general" class="standings-table-container tab-content active">
                    <div class="table-container">
                        <table id="standings-general-table" class="standings-table">
                            <thead>
                                <tr>
                                    <th>Rang</th>
                                    <th>√âquipe</th>
                                    <th>MJ</th>
                                    <th>V</th>
                                    <th>N</th>
                                    <th>D</th>
                                    <th>BP</th>
                                    <th>BC</th>
                                    <th>DB</th>
                                    <th>Pts</th>
                                    <th>Pts/M</th>
                                    <th>%Vic</th>
                                    <th>BP/M</th>
                                    <th>BC/M</th>
                                </tr>
                            </thead>
                            <tbody id="standings-general-tbody">
                                <tr>
                                    <td colspan="13" class="loading">Chargement des donn√©es...</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>

                <!-- Tableau Domicile -->
                <div id="standings-home" class="standings-table-container tab-content">
                    <div class="table-container">
                        <table id="standings-home-table" class="standings-table">
                            <thead>
                                <tr>
                                    <th>Rang</th>
                                    <th>√âquipe</th>
                                    <th>MJ</th>
                                    <th>V</th>
                                    <th>N</th>
                                    <th>D</th>
                                    <th>BP</th>
                                    <th>BC</th>
                                    <th>DB</th>
                                    <th>Pts</th>
                                    <th>Pts/M</th>
                                    <th>%Vic</th>
                                    <th>BP/M</th>
                                    <th>BC/M</th>
                                </tr>
                            </thead>
                            <tbody id="standings-home-tbody">
                                <tr>
                                    <td colspan="14" class="loading">Chargement des donn√©es...</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>

                <!-- Tableau Ext√©rieur -->
                <div id="standings-away" class="standings-table-container tab-content">
                    <div class="table-container">
                        <table id="standings-away-table" class="standings-table">
                            <thead>
                                <tr>
                                    <th>Rang</th>
                                    <th>√âquipe</th>
                                    <th>MJ</th>
                                    <th>V</th>
                                    <th>N</th>
                                    <th>D</th>
                                    <th>BP</th>
                                    <th>BC</th>
                                    <th>DB</th>
                                    <th>Pts</th>
                                    <th>Pts/M</th>
                                    <th>%Vic</th>
                                    <th>BP/M</th>
                                    <th>BC/M</th>
                                </tr>
                            </thead>
                            <tbody id="standings-away-tbody">
                                <tr>
                                    <td colspan="14" class="loading">Chargement des donn√©es...</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </section>

        <section id="matches" class="section-content">
            <div class="container">
                <h2 class="section-title">Tous les Matchs</h2>
                <div id="matches-react-root"></div>
            </div>
        </section>

        <section id="mercato" class="section-content">
            <div class="container">
                <h2 class="section-title">Mercato</h2>
                <div id="mercato-react-root"></div>
            </div>
        </section>
        <section id="news" class="section-content">
            <div class="container">
                <h2 class="section-title">Actualit√©s OL</h2>
                <div id="news-react-root"></div>
            </div>
        </section>

        <!-- Section Joueurs -->
        <section id="players" class="section-content">
            <div class="container">
                <h2 class="section-title">Joueurs Cl√©s</h2>
                <div class="card-bg p-4 rounded-xl mb-4 grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div>
                        <label for="players-filter-role" class="block text-sm font-medium text-gray-300 mb-1">Filtrer par poste</label>
                        <select id="players-filter-role" class="w-full bg-slate-800 border border-slate-600 rounded-lg px-3 py-2 text-white focus:ring-2 focus:ring-blue-500">
                            <option value="all">Tous les postes</option>
                            <option value="gardien">Gardiens</option>
                            <option value="d√©fenseur">D√©fenseurs</option>
                            <option value="milieu">Milieux</option>
                            <option value="offensif">Offensifs</option>
                        </select>
                    </div>
                    <div>
                        <label for="players-filter-minutes" class="block text-sm font-medium text-gray-300 mb-1">Minutes minimum jou√©es</label>
                        <select id="players-filter-minutes" class="w-full bg-slate-800 border border-slate-600 rounded-lg px-3 py-2 text-white focus:ring-2 focus:ring-blue-500">
                            <option value="0">Toutes les minutes</option>
                            <option value="300">‚â• 300 minutes</option>
                            <option value="600">‚â• 600 minutes</option>
                            <option value="900">‚â• 900 minutes</option>
                            <option value="1200">‚â• 1200 minutes</option>
                        </select>
                    </div>
                </div>
                <div class="table-container">
                    <table id="players-table" class="standings-table">
                        <thead>
                            <tr>
                                <th>Joueur</th>
                                <th>Poste</th>
                                <th>Minutes</th>
                                <th>Note</th>
                                <th>Importance</th>
                            </tr>
                        </thead>
                        <tbody id="players-tbody">
                            <tr>
                                <td colspan="5" class="loading">
                                    Chargement des joueurs...
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </section>

        <!-- Section Analyse Match -->
        <section id="match-analysis" class="section-content">
            <div class="container">
                <h2 class="section-title">Analyse d'Avant-Match</h2>
                
                <!-- Contr√¥les de s√©lection -->
                <div class="analysis-controls card-bg p-6 rounded-xl mb-8">
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                        <div class="form-group">
                            <label class="block text-sm font-medium text-gray-300 mb-2">Adversaire</label>
                            <select id="analysis-opponent" class="w-full bg-slate-800 border border-slate-600 rounded-lg px-4 py-2 text-white focus:ring-2 focus:ring-blue-500">
                                <option value="Brest">Brest</option>
                                <option value="Paris Saint Germain">Paris SG</option>
                                <option value="Marseille">Marseille</option>
                                <option value="Monaco">Monaco</option>
                                <option value="Lille">Lille</option>
                                <option value="Lens">Lens</option>
                                <option value="Nice">Nice</option>
                                <option value="Rennes">Rennes</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label class="block text-sm font-medium text-gray-300 mb-2">Lieu</label>
                            <select id="analysis-location" class="w-full bg-slate-800 border border-slate-600 rounded-lg px-4 py-2 text-white focus:ring-2 focus:ring-blue-500">
                                <option value="home">Domicile (Groupama Stadium)</option>
                                <option value="away">Ext√©rieur</option>
                            </select>
                        </div>
                        <div class="form-group flex items-end">
                            <button id="btn-analyze" class="w-full btn btn-primary">Lancer l'Analyse</button>
                        </div>
                    </div>
                </div>

                <!-- R√©sultats de l'analyse -->
                <div id="analysis-results" class="hidden space-y-8">
                    <!-- En-t√™te du match -->
                    <div class="match-header text-center mb-8">
                        <div class="flex items-center justify-center gap-8">
                            <div class="team-display">
                                <div class="text-4xl mb-2">ü¶Å</div>
                                <h3 class="text-xl font-bold">Olympique Lyonnais</h3>
                                <p class="text-gray-400" id="ol-rank">Loading...</p>
                            </div>
                            <div class="vs-badge bg-slate-700 px-4 py-2 rounded-full font-bold">VS</div>
                            <div class="team-display">
                                <div class="text-4xl mb-2">üõ°Ô∏è</div>
                                <h3 class="text-xl font-bold" id="opponent-name">Adversaire</h3>
                                <p class="text-gray-400" id="opponent-rank">Loading...</p>
                            </div>
                        </div>
                        <p id="analysis-type-badge" class="mt-4 text-sm text-gray-300">
                            Type d'analyse : en attente de s√©lection de match.
                        </p>
                    </div>

                    <!-- Cartes de stats -->
                    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6">
                        <div class="stat-card-detailed bg-slate-800 p-4 rounded-xl border border-slate-700">
                            <h4 class="text-gray-400 text-sm mb-1">Probabilit√© Victoire OL</h4>
                            <div class="text-2xl font-bold text-blue-400" id="prob-win">--%</div>
                            <div class="w-full bg-slate-700 h-2 rounded-full mt-2">
                                <div id="prob-bar" class="bg-blue-500 h-2 rounded-full" style="width: 0%"></div>
                            </div>
                            <div class="mt-2 text-xs text-gray-400 space-y-1">
                                <div>Match nul : <span id="prob-draw">--%</span></div>
                                <div>Victoire adverse : <span id="prob-loss">--%</span></div>
                            </div>
                        </div>
                        <div class="stat-card-detailed bg-slate-800 p-4 rounded-xl border border-slate-700">
                            <h4 class="text-gray-400 text-sm mb-1">Score Pr√©dit</h4>
                            <div class="text-2xl font-bold text-white" id="pred-score">-- - --</div>
                            <p class="text-xs text-gray-500 mt-1">Bas√© sur le moteur explicable</p>
                        </div>
                        <div class="stat-card-detailed bg-slate-800 p-4 rounded-xl border border-slate-700">
                            <h4 class="text-gray-400 text-sm mb-1">Buts Attendus (xG)</h4>
                            <div class="text-2xl font-bold text-green-400" id="pred-xg">--</div>
                            <p class="text-xs text-gray-500 mt-1">xG attendu pour l'OL</p>
                        </div>
                        <div class="stat-card-detailed bg-slate-800 p-4 rounded-xl border border-slate-700">
                            <h4 class="text-gray-400 text-sm mb-1">Forme (5 derniers)</h4>
                            <div class="flex gap-1 mt-2 justify-center" id="form-icons">
                                <!-- W D L W W -->
                            </div>
                        </div>
                    </div>

                    <!-- Analyse d√©taill√©e -->
                    <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
                        <div class="analysis-card bg-slate-800/50 p-6 rounded-xl border border-slate-700">
                            <h3 class="text-xl font-bold mb-4 flex items-center gap-2">
                                <span>üìä</span> Comparatif Direct
                            </h3>
                            <div class="space-y-4">
                                <div class="comparison-row">
                                    <div class="flex justify-between text-sm mb-1">
                                        <span>Attaque (Buts/M)</span>
                                        <span class="text-gray-400">vs</span>
                                    </div>
                                    <div class="flex items-center gap-4">
                                        <div class="w-1/2 text-right font-bold text-blue-400" id="comp-ol-attack">--</div>
                                        <div class="w-1/2 font-bold text-red-400" id="comp-opp-attack">--</div>
                                    </div>
                                    <div class="flex h-2 rounded-full overflow-hidden bg-slate-700 mt-1">
                                        <div id="bar-attack-ol" class="bg-blue-500 h-full" style="width: 50%"></div>
                                        <div id="bar-attack-opp" class="bg-red-500 h-full" style="width: 50%"></div>
                                    </div>
                                </div>

                                <div class="comparison-row">
                                    <div class="flex justify-between text-sm mb-1">
                                        <span>D√©fense (Buts Enc./M)</span>
                                        <span class="text-gray-400">vs</span>
                                    </div>
                                    <div class="flex items-center gap-4">
                                        <div class="w-1/2 text-right font-bold text-blue-400" id="comp-ol-defense">--</div>
                                        <div class="w-1/2 font-bold text-red-400" id="comp-opp-defense">--</div>
                                    </div>
                                    <div class="flex h-2 rounded-full overflow-hidden bg-slate-700 mt-1">
                                        <div id="bar-defense-ol" class="bg-blue-500 h-full" style="width: 50%"></div>
                                        <div id="bar-defense-opp" class="bg-red-500 h-full" style="width: 50%"></div>
                                    </div>
                                </div>

                                <div class="comparison-row">
                                    <div class="flex justify-between text-sm mb-1">
                                        <span>Points par Match</span>
                                        <span class="text-gray-400">vs</span>
                                    </div>
                                    <div class="flex items-center gap-4">
                                        <div class="w-1/2 text-right font-bold text-blue-400" id="comp-ol-ppm">--</div>
                                        <div class="w-1/2 font-bold text-red-400" id="comp-opp-ppm">--</div>
                                    </div>
                                    <div class="flex h-2 rounded-full overflow-hidden bg-slate-700 mt-1">
                                        <div id="bar-ppm-ol" class="bg-blue-500 h-full" style="width: 50%"></div>
                                        <div id="bar-ppm-opp" class="bg-red-500 h-full" style="width: 50%"></div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="analysis-card bg-slate-800/50 p-6 rounded-xl border border-slate-700">
                            <h3 class="text-xl font-bold mb-4 flex items-center gap-2">
                                <span>üß†</span> Analyse du moteur
                            </h3>
                            <div class="space-y-6">
                                <div>
                                    <h4 class="text-sm font-semibold text-slate-100 mb-2">Pourquoi ce r√©sultat ?</h4>
                                    <p id="engine-explanation-text" class="text-sm text-slate-300">
                                        Lancez une analyse pour voir l'explication compl√®te du moteur.
                                    </p>
                                </div>
                                <div>
                                    <h4 class="text-sm font-semibold text-slate-100 mb-2">Facteurs cl√©s</h4>
                                    <ul id="engine-key-factors" class="text-sm text-slate-300 space-y-1">
                                        <li>En attente d'analyse.</li>
                                    </ul>
                                </div>
                                <div>
                                    <h4 class="text-sm font-semibold text-slate-100 mb-2">Stats avanc√©es</h4>
                                    <div id="engine-advanced-stats" class="text-sm text-slate-300 space-y-1">
                                        <div>xG attendu, impact des absences et rating global seront affich√©s ici.</div>
                                    </div>
                                </div>
                                <div>
                                    <h4 class="text-sm font-semibold text-slate-100 mb-2">Groupe & absences</h4>
                                    <p id="analysis-absences-summary" class="text-sm text-slate-300">
                                        En attente d‚Äôinformations de groupe ou de blessures.
                                    </p>
                                    <div id="analysis-absent-players" class="mt-2 flex flex-wrap gap-2"></div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Section Compositions -->
        <section id="lineups" class="section-content">
            <div class="container">
                <h2 class="section-title">Compositions d'√âquipe</h2>
                <div class="table-container">
                    <table id="lineups-table">
                        <thead>
                            <tr>
                                <th>Match</th>
                                <th>Adversaire</th>
                                <th>Score</th>
                                <th>Voir Composition</th>
                            </tr>
                        </thead>
                        <tbody id="lineups-tbody">
                            <tr>
                                <td colspan="4" class="loading">Chargement des donn√©es...</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </section>

        <!-- Section Statistiques -->
        <section id="stats" class="section-content">
            <div class="container">
                <h2 class="section-title">Statistiques D√©taill√©es</h2>
                <div class="stats-grid-detailed">
                    <div class="stat-card-large">
                        <h3>Statistiques des Matchs</h3>
                        <div id="match-stats" class="loading">Chargement...</div>
                    </div>
                    <div class="stat-card-large">
                        <h3>Meilleures Combinaisons</h3>
                        <div id="combo-stats" class="loading">Chargement...</div>
                    </div>
                    <div class="stat-card-large">
                        <h3>OL (FBref, saison en cours)</h3>
                        <div id="ol-fbref-stats" class="loading">Chargement...</div>
                    </div>
                </div>
            </div>
        </section>

        <section id="styles" class="section-content">
            <div class="container">
                <h2 class="section-title">Styles d'√âquipes</h2>
                <div class="card-bg p-6 rounded-xl mb-6">
                    <label class="block text-sm font-medium text-gray-300 mb-2">Contexte</label>
                    <select id="styles-context" class="w-full bg-slate-800 border border-slate-600 rounded-lg px-4 py-2 text-white focus:ring-2 focus:ring-blue-500">
                        <option value="general">G√©n√©ral</option>
                        <option value="home">Domicile</option>
                        <option value="away">Ext√©rieur</option>
                    </select>
                </div>
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6">
                    <div class="stat-card-large">
                        <h3>Bloc bas</h3>
                        <ul id="style-low-block" class="space-y-2"></ul>
                    </div>
                    <div class="stat-card-large">
                        <h3>Bloc serr√©</h3>
                        <ul id="style-compact" class="space-y-2"></ul>
                    </div>
                    <div class="stat-card-large">
                        <h3>Joue haut</h3>
                        <ul id="style-high-line" class="space-y-2"></ul>
                    </div>
                    <div class="stat-card-large">
                        <h3>Laisse des espaces</h3>
                        <ul id="style-spaces" class="space-y-2"></ul>
                    </div>
                </div>
            </div>
        </section>

        <section id="combos-advanced" class="section-content">
            <div class="container">
                <h2 class="section-title">Combinaisons Avanc√©es de Joueurs</h2>
                <div id="combos-react-root"></div>
            </div>
        </section>
    </main>

    <footer class="footer">
        <div class="footer-content">
            <p>&copy; 2024 OL Match Analyzer. Tous droits r√©serv√©s.</p>
            <p class="footer-subtitle">Analyse de donn√©es avanc√©e pour le football</p>
        </div>
    </footer>

    <script src="script.js"></script>
    <script type="text/babel">
        const { useState, useEffect } = React;

        function useCsvData(url) {
            const [state, setState] = useState({
                loading: true,
                error: null,
                rows: []
            });

            useEffect(() => {
                let cancelled = false;

                async function load() {
                    try {
                        const bustedUrl = url + (url.includes('?') ? '&' : '?') + '_=' + Date.now();
                        const res = await fetch(bustedUrl);
                        if (!res.ok) {
                            throw new Error('Erreur r√©seau');
                        }
                        const text = await res.text();
                        const parse = typeof parseCSV === 'function' ? parseCSV : null;
                        if (!parse) {
                            throw new Error('parseCSV non disponible');
                        }
                        const rows = parse(text) || [];
                        if (!cancelled) {
                            setState({ loading: false, error: null, rows });
                        }
                    } catch (e) {
                        if (!cancelled) {
                            setState({
                                loading: false,
                                error: e.message || 'Erreur inconnue',
                                rows: []
                            });
                        }
                    }
                }

                load();

                return () => {
                    cancelled = true;
                };
            }, [url]);

            return state;
        }

        function MatchAnalysisDashboard() {
            const {
                loading,
                error,
                rows: matchRows
            } = useCsvData('data/processed/ol_match_score_final.csv');
            const {
                loading: playersLoading,
                error: playersError,
                rows: playerRows
            } = useCsvData('data/processed/ol_key_players.csv');
            const {
                loading: combosLoading,
                error: combosError,
                rows: comboRows
            } = useCsvData('data/processed/ol_best_combos_2_players.csv');

            if (loading || playersLoading || combosLoading) {
                return (
                    <div className="mt-6 rounded-2xl border border-slate-700 bg-slate-900/80 px-6 py-4 text-slate-100 shadow-lg">
                        Chargement des analyses...
                    </div>
                );
            }

            const combinedError = error || playersError || combosError;
            if (combinedError || !matchRows || matchRows.length === 0) {
                return (
                    <div className="mt-6 rounded-2xl border border-red-500/60 bg-red-900/40 px-6 py-4 text-sm text-red-100">
                        {combinedError || 'Impossible d‚Äôafficher le tableau de bord'}
                    </div>
                );
            }

            const matches = matchRows;
            const players = playerRows || [];
            const combos = comboRows || [];

            const totalMatches = matches.length;
            const wins = matches.filter(m => m.result === 'W').length;
            const draws = matches.filter(m => m.result === 'D').length;
            const losses = matches.filter(m => m.result === 'L').length;
            const totalPoints = matches.reduce(
                (sum, m) => sum + (parseInt(m.points || '0', 10) || 0),
                0
            );
            const avgRating =
                matches.reduce(
                    (sum, m) => sum + (parseFloat(m.match_rating || '0') || 0),
                    0
                ) / totalMatches;
            const avgScoreFinal =
                matches.reduce(
                    (sum, m) => sum + (parseFloat(m.score_final || '0') || 0),
                    0
                ) / totalMatches;

            const matchStats = {
                totalMatches,
                wins,
                draws,
                losses,
                totalPoints,
                pointsPerMatch: totalPoints / totalMatches,
                avgRating,
                avgScoreFinal
            };

            const winRate = (wins / totalMatches) * 100;
            const drawRate = (draws / totalMatches) * 100;
            const lossRate = (losses / totalMatches) * 100;

            const topPlayers = players
                .filter(p => p.player)
                .sort(
                    (a, b) =>
                        (parseFloat(b.importance || '0') || 0) -
                        (parseFloat(a.importance || '0') || 0)
                )
                .slice(0, 5)
                .map(p => ({
                    name: p.player,
                    pos: p.pos,
                    minutes: parseInt(p['Playing Time_Min'] || '0', 10) || 0,
                    rating: parseFloat(p.rating || '0') || 0,
                    importance: parseFloat(p.importance || '0') || 0
                }));

            const topCombos = combos
                .filter(c => c.combo)
                .sort(
                    (a, b) =>
                        (parseFloat(b.avg_points || '0') || 0) -
                        (parseFloat(a.avg_points || '0') || 0)
                )
                .slice(0, 5)
                .map(c => ({
                    name: c.combo,
                    matches: parseInt(c.matches || '0', 10) || 0,
                    avgPoints: parseFloat(c.avg_points || '0') || 0,
                    avgScoreFinal: parseFloat(c.avg_score_final || '0') || 0
                }));

            const maxMinutes = topPlayers.reduce(
                (max, p) => (p.minutes > max ? p.minutes : max),
                0
            );

            return (
                <div className="mt-6 space-y-6 rounded-2xl border border-slate-700 bg-slate-900/80 p-6 text-slate-100 shadow-xl">
                    <div className="flex flex-col gap-4 md:flex-row md:items-baseline md:justify-between">
                        <div>
                            <p className="text-xs uppercase tracking-wide text-slate-400">
                                Olympique Lyonnais 2025-2026
                            </p>
                            <h3 className="text-lg font-semibold">
                                Vue d&apos;ensemble avanc√©e des performances
                            </h3>
                        </div>
                        <span className="inline-flex items-center rounded-full bg-emerald-500/10 px-3 py-1 text-xs font-medium text-emerald-300">
                            Donn√©es r√©elles charg√©es depuis plusieurs CSV
                        </span>
                    </div>

                    <div className="grid gap-4 lg:grid-cols-3">
                        <div className="space-y-4 rounded-xl bg-slate-900/60 p-4">
                            <p className="text-xs font-medium uppercase tracking-wide text-slate-400">
                                R√©sum√© des matchs
                            </p>
                            <div className="grid grid-cols-2 gap-3">
                                <div>
                                    <p className="text-xs text-slate-400">
                                        Matchs jou√©s
                                    </p>
                                    <p className="mt-1 text-2xl font-semibold">
                                        {matchStats.totalMatches}
                                    </p>
                                    <p className="mt-1 text-xs text-slate-400">
                                        {matchStats.wins} V ¬∑ {matchStats.draws} N ¬∑ {matchStats.losses} D
                                    </p>
                                </div>
                                <div>
                                    <p className="text-xs text-slate-400">Points</p>
                                    <p className="mt-1 text-2xl font-semibold">
                                        {matchStats.totalPoints}
                                    </p>
                                    <p className="mt-1 text-xs text-slate-400">
                                        {matchStats.pointsPerMatch.toFixed(2)} pts/match
                                    </p>
                                </div>
                                <div>
                                    <p className="text-xs text-slate-400">
                                        Note de match moyenne
                                    </p>
                                    <p className="mt-1 text-2xl font-semibold">
                                        {matchStats.avgRating.toFixed(1)}
                                    </p>
                                    <p className="mt-1 text-xs text-slate-400">
                                        Score interne de performance
                                    </p>
                                </div>
                                <div>
                                    <p className="text-xs text-slate-400">
                                        Score final moyen
                                    </p>
                                    <p className="mt-1 text-2xl font-semibold">
                                        {matchStats.avgScoreFinal.toFixed(1)}
                                    </p>
                                    <p className="mt-1 text-xs text-slate-400">
                                        Indice global de qualit√© de match
                                    </p>
                                </div>
                            </div>
                            <div className="mt-4 space-y-3">
                                <div className="flex items-center justify-between text-xs text-slate-400">
                                    <span>Victoires</span>
                                    <span>{winRate.toFixed(1)}%</span>
                                </div>
                                <div className="h-2 w-full overflow-hidden rounded-full bg-slate-800">
                                    <div
                                        className="h-full rounded-full bg-emerald-500"
                                        style={{ width: `${winRate}%` }}
                                    />
                                </div>
                                <div className="flex items-center justify-between text-xs text-slate-400">
                                    <span>Nuls</span>
                                    <span>{drawRate.toFixed(1)}%</span>
                                </div>
                                <div className="h-2 w-full overflow-hidden rounded-full bg-slate-800">
                                    <div
                                        className="h-full rounded-full bg-amber-400"
                                        style={{ width: `${drawRate}%` }}
                                    />
                                </div>
                                <div className="flex items-center justify-between text-xs text-slate-400">
                                    <span>D√©faites</span>
                                    <span>{lossRate.toFixed(1)}%</span>
                                </div>
                                <div className="h-2 w-full overflow-hidden rounded-full bg-slate-800">
                                    <div
                                        className="h-full rounded-full bg-rose-500"
                                        style={{ width: `${lossRate}%` }}
                                    />
                                </div>
                            </div>
                        </div>

                        <div className="space-y-3 rounded-xl bg-slate-900/60 p-4">
                            <div className="flex items-center justify-between">
                                <p className="text-xs font-medium uppercase tracking-wide text-slate-400">
                                    Joueurs cl√©s
                                </p>
                                <span className="text-xs text-slate-500">
                                    Top {topPlayers.length} par importance
                                </span>
                            </div>
                            <ul className="space-y-2 text-sm">
                                {topPlayers.map(player => (
                                    <li
                                        key={player.name}
                                        className="rounded-lg bg-slate-900/80 px-3 py-2"
                                    >
                                        <div className="flex items-center justify-between">
                                            <div>
                                                <p className="font-medium">{player.name}</p>
                                                <p className="text-xs text-slate-400">
                                                    {player.pos} ¬∑ {player.minutes.toLocaleString('fr-FR')} min
                                                </p>
                                            </div>
                                            <div className="text-right">
                                                <p className="text-xs text-slate-400">
                                                    Note
                                                </p>
                                                <p className="text-sm font-semibold">
                                                    {player.rating.toFixed(1)}
                                                </p>
                                                <p className="text-[10px] text-slate-500">
                                                    Importance {player.importance.toFixed(1)}
                                                </p>
                                            </div>
                                        </div>
                                        {maxMinutes > 0 && (
                                            <div className="mt-2 h-1.5 w-full overflow-hidden rounded-full bg-slate-800">
                                                <div
                                                    className="h-full rounded-full bg-sky-500"
                                                    style={{
                                                        width: `${(player.minutes / maxMinutes) * 100}%`
                                                    }}
                                                />
                                            </div>
                                        )}
                                    </li>
                                ))}
                            </ul>
                        </div>

                        <div className="space-y-3 rounded-xl bg-slate-900/60 p-4">
                            <div className="flex items-center justify-between">
                                <p className="text-xs font-medium uppercase tracking-wide text-slate-400">
                                    Meilleures combinaisons (2 joueurs)
                                </p>
                                <span className="text-xs text-slate-500">
                                    Class√©es par points moyens
                                </span>
                            </div>
                            <ul className="space-y-2 text-sm">
                                {topCombos.map(combo => (
                                    <li
                                        key={combo.name}
                                        className="space-y-1 rounded-lg bg-slate-900/80 px-3 py-2"
                                    >
                                        <div className="flex items-center justify-between">
                                            <div className="pr-2">
                                                <p className="font-medium">{combo.name}</p>
                                                <p className="text-xs text-slate-400">
                                                    {combo.matches} matchs jou√©s
                                                </p>
                                            </div>
                                            <div className="text-right">
                                                <p className="text-xs text-slate-400">
                                                    Pts/match
                                                </p>
                                                <p className="text-sm font-semibold">
                                                    {combo.avgPoints.toFixed(2)}
                                                </p>
                                                <p className="text-[10px] text-slate-500">
                                                    Score final {combo.avgScoreFinal.toFixed(1)}
                                                </p>
                                            </div>
                                        </div>
                                        <div className="h-1.5 w-full overflow-hidden rounded-full bg-slate-800">
                                            <div
                                                className="h-full rounded-full bg-emerald-500"
                                                style={{
                                                    width: `${Math.min(
                                                        (combo.avgPoints / 3) * 100,
                                                        100
                                                    )}%`
                                                }}
                                            />
                                        </div>
                                    </li>
                                ))}
                            </ul>
                        </div>
                    </div>
                </div>
            );
        }

        function MatchesReactTable() {
            const { loading, error, rows } = useCsvData(
                'data/processed/ol_match_score_final.csv'
            );
            const [venueFilter, setVenueFilter] = useState('all');
            const [resultFilter, setResultFilter] = useState('all');
            const [sortBy, setSortBy] = useState('date_desc');

            if (loading) {
                return (
                    <div className="table-container">
                        <div className="loading">Chargement des matchs...</div>
                    </div>
                );
            }

            if (error) {
                return (
                    <div className="table-container">
                        <div className="error">
                            Erreur lors du chargement des matchs: {error}
                        </div>
                    </div>
                );
            }

            let matches = rows || [];

            matches = matches.filter(m => {
                if (venueFilter === 'home' && m.venue !== 'Home') {
                    return false;
                }
                if (venueFilter === 'away' && m.venue !== 'Away') {
                    return false;
                }
                if (resultFilter === 'W' && m.result !== 'W') {
                    return false;
                }
                if (resultFilter === 'D' && m.result !== 'D') {
                    return false;
                }
                if (resultFilter === 'L' && m.result !== 'L') {
                    return false;
                }
                return true;
            });

            matches.sort((a, b) => {
                if (sortBy === 'date_asc') {
                    return new Date(a.date) - new Date(b.date);
                }
                if (sortBy === 'points_desc') {
                    return (parseInt(b.points || '0', 10) || 0) -
                        (parseInt(a.points || '0', 10) || 0);
                }
                if (sortBy === 'rating_desc') {
                    return (parseFloat(b.match_rating || '0') || 0) -
                        (parseFloat(a.match_rating || '0') || 0);
                }
                return new Date(b.date) - new Date(a.date);
            });

            const handleRowClick = match => {
                const content = `
                    <div class="match-details">
                        <h3>D√©tails du Match</h3>
                        <p><strong>Date:</strong> ${formatDate(match.date)}</p>
                        <p><strong>Adversaire:</strong> ${match.opponent || ''}</p>
                        <p><strong>Lieu:</strong> ${
                            match.venue === 'Home' ? 'Domicile' : 'Ext√©rieur'
                        }</p>
                        <p><strong>R√©sultat:</strong> ${
                            match.result === 'W'
                                ? 'Victoire'
                                : match.result === 'D'
                                ? 'Nul'
                                : 'D√©faite'
                        }</p>
                        <p><strong>Points:</strong> ${match.points || 0}</p>
                        <p><strong>Note:</strong> ${(
                            parseFloat(match.match_rating || 0) || 0
                        ).toFixed(1)}</p>
                        <p><strong>Score:</strong> ${match.score_final || ''}</p>
                    </div>
                `;
                createModal(`Match: OL vs ${match.opponent || ''}`, content);
            };

            return (
                <div className="space-y-4">
                    <div className="flex flex-wrap gap-3 rounded-xl bg-slate-900/60 p-4">
                        <div className="flex flex-col text-sm text-slate-200">
                            <label className="mb-1 text-xs text-slate-400">
                                Lieu
                            </label>
                            <select
                                className="rounded-md border border-slate-700 bg-slate-900 px-2 py-1 text-xs"
                                value={venueFilter}
                                onChange={e => setVenueFilter(e.target.value)}
                            >
                                <option value="all">Tous</option>
                                <option value="home">Domicile</option>
                                <option value="away">Ext√©rieur</option>
                            </select>
                        </div>
                        <div className="flex flex-col text-sm text-slate-200">
                            <label className="mb-1 text-xs text-slate-400">
                                R√©sultat
                            </label>
                            <select
                                className="rounded-md border border-slate-700 bg-slate-900 px-2 py-1 text-xs"
                                value={resultFilter}
                                onChange={e => setResultFilter(e.target.value)}
                            >
                                <option value="all">Tous</option>
                                <option value="W">Victoire</option>
                                <option value="D">Nul</option>
                                <option value="L">D√©faite</option>
                            </select>
                        </div>
                        <div className="flex flex-col text-sm text-slate-200">
                            <label className="mb-1 text-xs text-slate-400">
                                Tri
                            </label>
                            <select
                                className="rounded-md border border-slate-700 bg-slate-900 px-2 py-1 text-xs"
                                value={sortBy}
                                onChange={e => setSortBy(e.target.value)}
                            >
                                <option value="date_desc">Date d√©croissante</option>
                                <option value="date_asc">Date croissante</option>
                                <option value="points_desc">Points d√©croissants</option>
                                <option value="rating_desc">
                                    Note de match d√©croissante
                                </option>
                            </select>
                        </div>
                    </div>
                    <div className="table-container">
                        <table id="matches-table">
                            <thead>
                                <tr>
                                    <th>Date</th>
                                    <th>Adversaire</th>
                                    <th>Lieu</th>
                                    <th>R√©sultat</th>
                                    <th>Points</th>
                                    <th>Note</th>
                                    <th>Score</th>
                                </tr>
                            </thead>
                            <tbody>
                                {matches.map(match => (
                                    <tr
                                        key={match.match_key || match.date + match.opponent}
                                        style={{ cursor: 'pointer' }}
                                        onClick={() => handleRowClick(match)}
                                    >
                                        <td>{formatDate(match.date)}</td>
                                        <td>{match.opponent || ''}</td>
                                        <td>
                                            {match.venue === 'Home'
                                                ? 'Domicile'
                                                : 'Ext√©rieur'}
                                        </td>
                                        <td>
                                            <span className={getResultBadge(match.result)}>
                                                {match.result === 'W'
                                                    ? 'Victoire'
                                                    : match.result === 'D'
                                                    ? 'Nul'
                                                    : 'D√©faite'}
                                            </span>
                                        </td>
                                        <td>{match.points || 0}</td>
                                        <td>
                                            {(
                                                parseFloat(match.match_rating || 0) || 0
                                            ).toFixed(1)}
                                        </td>
                                        <td>{match.score_final || ''}</td>
                                    </tr>
                                ))}
                                {matches.length === 0 && (
                                    <tr>
                                        <td colSpan="7" className="loading">
                                            Aucun match ne correspond aux filtres
                                        </td>
                                    </tr>
                                )}
                            </tbody>
                        </table>
                    </div>
                </div>
            );
        }

        function MatchesReactTableByRound() {
            const a = useCsvData('data/processed/ol_match_score_final.csv');
            const b = useCsvData('data/raw/ligue1_matches_raw.csv');
            const [venueFilter, setVenueFilter] = useState('all');
            const [resultFilter, setResultFilter] = useState('all');
            const [sortBy, setSortBy] = useState('round_asc');
            const [roundFilter, setRoundFilter] = useState('all');
            const loading = a.loading || b.loading;
            const error = a.error || b.error;
            const rows = a.rows || [];
            const rawRows = b.rows || [];
            if (loading) {
                return (
                    <div className="table-container">
                        <div className="loading">Chargement des matchs...</div>
                    </div>
                );
            }
            if (error) {
                return (
                    <div className="table-container">
                        <div className="error">Erreur lors du chargement des matchs: {error}</div>
                    </div>
                );
            }
            const lyonRaw = (rawRows || [])
                .filter(r => {
                    const mr = r.match_report || '';
                    return mr && (mr.toLowerCase().includes('lyon-') || mr.toLowerCase().includes('-lyon-'));
                })
                .filter(r => (r.opponent || '').toLowerCase() !== 'lyon');
            const roundMap = {};
            lyonRaw.forEach(r => {
                const d = r.date || '';
                const opp = r.opponent || '';
                const roundStr = r.round || '';
                const num = parseInt(String(roundStr).replace(/[^0-9]/g, ''), 10);
                if (d && opp && Number.isFinite(num)) {
                    roundMap[`${d}_${opp}`] = num;
                }
            });
            let olMatches = (rows || []).filter(m => (m.opponent || '').toLowerCase() !== 'lyon');
            olMatches.sort((a, b) => new Date(a.date) - new Date(b.date));
            const derivedRounds = {};
            olMatches.forEach((m, i) => {
                const key = `${m.date}_${m.opponent}`;
                if (!roundMap[key]) {
                    derivedRounds[key] = i + 1;
                }
            });
            const withRounds = olMatches.map(m => {
                const key = `${m.date}_${m.opponent}`;
                const r = roundMap[key] || derivedRounds[key] || null;
                return { ...m, round: r };
            });
            let matches = withRounds.slice();
            matches = matches.filter(m => {
                if (venueFilter === 'home' && m.venue !== 'Home') return false;
                if (venueFilter === 'away' && m.venue !== 'Away') return false;
                if (resultFilter === 'W' && m.result !== 'W') return false;
                if (resultFilter === 'D' && m.result !== 'D') return false;
                if (resultFilter === 'L' && m.result !== 'L') return false;
                if (roundFilter !== 'all' && Number.isFinite(m.round)) {
                    return m.round === parseInt(roundFilter, 10);
                }
                if (roundFilter !== 'all' && !Number.isFinite(m.round)) {
                    return false;
                }
                return true;
            });
            matches.sort((a, b) => {
                if (sortBy === 'date_asc') return new Date(a.date) - new Date(b.date);
                if (sortBy === 'date_desc') return new Date(b.date) - new Date(a.date);
                if (sortBy === 'points_desc') {
                    return (parseInt(b.points || '0', 10) || 0) - (parseInt(a.points || '0', 10) || 0);
                }
                if (sortBy === 'rating_desc') {
                    return (parseFloat(b.match_rating || '0') || 0) - (parseFloat(a.match_rating || '0') || 0);
                }
                if (sortBy === 'round_desc') {
                    return (parseInt(b.round || '0', 10) || 0) - (parseInt(a.round || '0', 10) || 0);
                }
                return (parseInt(a.round || '0', 10) || 0) - (parseInt(b.round || '0', 10) || 0);
            });
            const calendar = withRounds
                .slice()
                .sort((a, b) => {
                    const ra = parseInt(a.round || '0', 10) || 0;
                    const rb = parseInt(b.round || '0', 10) || 0;
                    if (ra !== rb) return ra - rb;
                    return new Date(a.date) - new Date(b.date);
                });
            const distinctRounds = Array.from(
                new Set(withRounds.map(m => m.round).filter(r => Number.isFinite(r)))
            ).sort((x, y) => x - y);
            const handleRowClick = match => {
                const content = `
                    <div class="match-details">
                        <h3>D√©tails du Match</h3>
                        <p><strong>Journ√©e:</strong> ${Number.isFinite(match.round) ? match.round : '-'}</p>
                        <p><strong>Date:</strong> ${formatDate(match.date)}</p>
                        <p><strong>Adversaire:</strong> ${match.opponent || ''}</p>
                        <p><strong>Lieu:</strong> ${match.venue === 'Home' ? 'Domicile' : 'Ext√©rieur'}</p>
                        <p><strong>R√©sultat:</strong> ${match.result === 'W' ? 'Victoire' : match.result === 'D' ? 'Nul' : 'D√©faite'}</p>
                        <p><strong>Points:</strong> ${match.points || 0}</p>
                        <p><strong>Note:</strong> ${(parseFloat(match.match_rating || 0) || 0).toFixed(1)}</p>
                        <p><strong>Score:</strong> ${match.score_final || ''}</p>
                    </div>
                `;
                createModal(`Match: OL vs ${match.opponent || ''}`, content);
            };
            return (
                <div className="space-y-4">
                    <div className="rounded-xl bg-slate-900/70 p-4">
                        <h3 className="text-sm font-semibold text-slate-100">
                            Calendrier des matchs OL par journ√©e (Aller / Retour)
                        </h3>
                        <div className="mt-3 flex gap-3 overflow-x-auto pb-2">
                            {calendar.map(match => {
                                const labelRound = Number.isFinite(match.round) ? `J ${match.round}` : 'J ?';
                                const vsLabel =
                                    match.venue === 'Home'
                                        ? `OL vs ${match.opponent || ''}`
                                        : `${match.opponent || ''} vs OL`;
                                const badgeClass =
                                    match.result === 'W'
                                        ? 'badge badge-win'
                                        : match.result === 'D'
                                        ? 'badge badge-draw'
                                        : match.result === 'L'
                                        ? 'badge badge-loss'
                                        : 'badge';
                                const ratingValue =
                                    (parseFloat(match.match_rating || 0) || 0).toFixed(1);
                                const roundNumber = Number.isFinite(match.round) ? match.round : null;
                                const legLabel =
                                    roundNumber && roundNumber <= 17 ? 'Aller' : roundNumber ? 'Retour' : '';
                                const cardStatusClass =
                                    match.result === 'W'
                                        ? 'border-emerald-500/60 bg-emerald-900/40'
                                        : match.result === 'D'
                                        ? 'border-slate-600 bg-slate-900/80'
                                        : match.result === 'L'
                                        ? 'border-rose-500/60 bg-rose-900/40'
                                        : 'border-slate-700 bg-slate-900/80';
                                return (
                                    <div
                                        key={(match.match_key || match.date + match.opponent) + '-card'}
                                        className={`min-w-[180px] cursor-pointer rounded-lg px-3 py-2 text-xs ${cardStatusClass}`}
                                        onClick={() => handleRowClick(match)}
                                    >
                                        <div className="flex items-center justify-between">
                                            <div className="flex flex-col">
                                                <span className="font-semibold text-slate-100">
                                                    {labelRound}
                                                </span>
                                                {legLabel && (
                                                    <span className="text-[10px] text-slate-300">
                                                        {legLabel}
                                                    </span>
                                                )}
                                            </div>
                                            <span className="text-[10px] text-slate-200">
                                                {formatDate(match.date)}
                                            </span>
                                        </div>
                                        <div className="mt-1 text-[11px] text-slate-100">
                                            {vsLabel}
                                        </div>
                                        <div className="mt-1 flex items-center justify-between">
                                            <span className={badgeClass}>
                                                {match.result === 'W'
                                                    ? 'V'
                                                    : match.result === 'D'
                                                    ? 'N'
                                                    : match.result === 'L'
                                                    ? 'D'
                                                    : '-'}
                                            </span>
                                            <span className="text-[10px] text-slate-100">
                                                {(match.points || 0) + ' pts ¬∑ ' + ratingValue}
                                            </span>
                                        </div>
                                    </div>
                                );
                            })}
                        </div>
                    </div>
                    <div className="flex flex-wrap gap-3 rounded-xl bg-slate-900/60 p-4">
                        <div className="flex flex-col text-sm text-slate-200">
                            <label className="mb-1 text-xs text-slate-400">Journ√©e</label>
                            <select
                                className="rounded-md border border-slate-700 bg-slate-900 px-2 py-1 text-xs"
                                value={roundFilter}
                                onChange={e => setRoundFilter(e.target.value)}
                            >
                                <option value="all">Toutes</option>
                                {distinctRounds.map(r => (
                                    <option key={`r-${r}`} value={String(r)}>J {r}</option>
                                ))}
                            </select>
                        </div>
                        <div className="flex flex-col text-sm text-slate-200">
                            <label className="mb-1 text-xs text-slate-400">Lieu</label>
                            <select
                                className="rounded-md border border-slate-700 bg-slate-900 px-2 py-1 text-xs"
                                value={venueFilter}
                                onChange={e => setVenueFilter(e.target.value)}
                            >
                                <option value="all">Tous</option>
                                <option value="home">Domicile</option>
                                <option value="away">Ext√©rieur</option>
                            </select>
                        </div>
                        <div className="flex flex-col text-sm text-slate-200">
                            <label className="mb-1 text-xs text-slate-400">R√©sultat</label>
                            <select
                                className="rounded-md border border-slate-700 bg-slate-900 px-2 py-1 text-xs"
                                value={resultFilter}
                                onChange={e => setResultFilter(e.target.value)}
                            >
                                <option value="all">Tous</option>
                                <option value="W">Victoire</option>
                                <option value="D">Nul</option>
                                <option value="L">D√©faite</option>
                            </select>
                        </div>
                        <div className="flex flex-col text-sm text-slate-200">
                            <label className="mb-1 text-xs text-slate-400">Tri</label>
                            <select
                                className="rounded-md border border-slate-700 bg-slate-900 px-2 py-1 text-xs"
                                value={sortBy}
                                onChange={e => setSortBy(e.target.value)}
                            >
                                <option value="round_asc">Journ√©e croissante</option>
                                <option value="round_desc">Journ√©e d√©croissante</option>
                                <option value="date_asc">Date croissante</option>
                                <option value="date_desc">Date d√©croissante</option>
                                <option value="points_desc">Points d√©croissants</option>
                                <option value="rating_desc">Note de match d√©croissante</option>
                            </select>
                        </div>
                    </div>
                    <div className="table-container">
                        <table id="matches-table">
                            <thead>
                                <tr>
                                    <th>Journ√©e</th>
                                    <th>Date</th>
                                    <th>Adversaire</th>
                                    <th>Lieu</th>
                                    <th>R√©sultat</th>
                                    <th>Points</th>
                                    <th>Note</th>
                                    <th>Score</th>
                                </tr>
                            </thead>
                            <tbody>
                                {matches.map(match => (
                                    <tr
                                        key={(match.match_key || match.date + match.opponent) + String(match.round || '')}
                                        style={{ cursor: 'pointer' }}
                                        onClick={() => handleRowClick(match)}
                                    >
                                        <td>{Number.isFinite(match.round) ? `J ${match.round}` : '-'}</td>
                                        <td>{formatDate(match.date)}</td>
                                        <td>{match.opponent || ''}</td>
                                        <td>{match.venue === 'Home' ? 'Domicile' : 'Ext√©rieur'}</td>
                                        <td>
                                            <span className={getResultBadge(match.result)}>
                                                {match.result === 'W' ? 'Victoire' : match.result === 'D' ? 'Nul' : 'D√©faite'}
                                            </span>
                                        </td>
                                        <td>{match.points || 0}</td>
                                        <td>{(parseFloat(match.match_rating || 0) || 0).toFixed(1)}</td>
                                        <td>{match.score_final || ''}</td>
                                    </tr>
                                ))}
                                {matches.length === 0 && (
                                    <tr>
                                        <td colSpan="8" className="loading">Aucun match ne correspond aux filtres</td>
                                    </tr>
                                )}
                            </tbody>
                        </table>
                    </div>
                </div>
            );
        }

        function PlayersSimpleReactTable() {
            const { loading, error, rows } = useCsvData(
                'data/processed/ol_key_players.csv'
            );

            if (loading) {
                return (
                    <div className="table-container">
                        <div className="loading">Chargement des joueurs...</div>
                    </div>
                );
            }

            if (error) {
                return (
                    <div className="table-container">
                        <div className="error">
                            Erreur lors du chargement des joueurs: {error}
                        </div>
                    </div>
                );
            }

            if (!rows || rows.length === 0) {
                return (
                    <div className="table-container">
                        <div className="error">
                            Aucune donn√©e trouv√©e dans data/processed/ol_key_players.csv
                        </div>
                    </div>
                );
            }

            const players = (rows || [])
                .map(p => ({
                    name: p.player,
                    pos: p.pos,
                    minutes: parseInt(p['Playing Time_Min'] || '0', 10) || 0,
                    rating: parseFloat(p.rating || '0') || 0,
                    importance: parseFloat(p.importance || '0') || 0
                }))
                .filter(p => p.name);

            players.sort(
                (a, b) =>
                    b.importance - a.importance
            );

            return (
                <div className="table-container">
                    <table className="standings-table">
                        <thead>
                            <tr>
                                <th>Joueur</th>
                                <th>Poste</th>
                                <th>Minutes</th>
                                <th>Note</th>
                                <th>Importance</th>
                            </tr>
                        </thead>
                        <tbody>
                            {players.map(player => (
                                <tr key={player.name}>
                                    <td>{player.name}</td>
                                    <td>{player.pos || ''}</td>
                                    <td>
                                        {player.minutes.toLocaleString('fr-FR')}
                                    </td>
                                    <td>{player.rating.toFixed(1)}</td>
                                    <td>{player.importance.toFixed(2)}</td>
                                </tr>
                            ))}
                        </tbody>
                    </table>
                </div>
            );
        }

        function PlayersReactTable() {
            const { loading, error, rows } = useCsvData(
                'data/processed/ol_key_players.csv'
            );
            const {
                loading: minutesLoading,
                error: minutesError,
                rows: minutesRows
            } = useCsvData('data/processed/ol_player_minutes.csv');
            const {
                rows: impactMatchRows
            } = useCsvData('data/processed/ol_player_match_impact.csv');
            const {
                rows: absenceImpactRows
            } = useCsvData('data/processed/ol_absence_impact.csv');
            const {
                rows: impactScoreRows
            } = useCsvData('data/processed/ol_player_impact_scores.csv');
            const {
                rows: comboImpactRows
            } = useCsvData('data/processed/ol_combo_impact_summary.csv');
            const [minMinutes, setMinMinutes] = useState(0);
            const [positionFilter, setPositionFilter] = useState('all');
            const [sortBy, setSortBy] = useState('importance_desc');
            const [selectedPlayerName, setSelectedPlayerName] = useState('');

            if (loading || minutesLoading) {
                return (
                    <div className="table-container">
                        <div className="loading">Chargement des joueurs...</div>
                    </div>
                );
            }

            if (!rows || rows.length === 0) {
                return <PlayersSimpleReactTable />;
            }

            if (!minutesRows || minutesRows.length === 0) {
                console.error(
                    'CSV vide ou non charg√©',
                    'data/processed/ol_player_minutes.csv',
                    minutesRows
                );
            }

            let players = [];
            try {
                players = (rows || []).map(p => ({
                    name: p.player,
                    pos: p.pos,
                    minutes: parseInt(p['Playing Time_Min'] || '0', 10) || 0,
                    rating: parseFloat(p.rating || '0') || 0,
                    importance: parseFloat(p.importance || '0') || 0,
                    gls90: parseFloat(p['Per 90 Minutes_Gls'] || '0') || 0,
                    ast90: parseFloat(p['Per 90 Minutes_Ast'] || '0') || 0,
                    xg90: parseFloat(p['Per 90 Minutes_xG'] || '0') || 0,
                    xag90: parseFloat(p['Per 90 Minutes_xAG'] || '0') || 0,
                    prgC: parseFloat(p['Progression_PrgC'] || '0') || 0,
                    prgP: parseFloat(p['Progression_PrgP'] || '0') || 0,
                    prgR: parseFloat(p['Progression_PrgR'] || '0') || 0,
                    cardsY: parseFloat(p['Performance_CrdY'] || '0') || 0,
                    cardsR: parseFloat(p['Performance_CrdR'] || '0') || 0,
                    goals: parseInt(p['Performance_Gls'] || '0', 10) || 0,
                    assists: parseInt(p['Performance_Ast'] || '0', 10) || 0
                }));
            } catch (e) {
                return <PlayersSimpleReactTable />;
            }

            if (!players || players.length === 0) {
                return <PlayersSimpleReactTable />;
            }

            const distinctPositions = Array.from(
                new Set(
                    players
                        .map(p => (p.pos || '').split(','))
                        .flat()
                        .map(s => s.trim())
                        .filter(Boolean)
                )
            );

            useEffect(() => {
                if (!selectedPlayerName && players.length > 0) {
                    const defaultPlayer = players
                        .slice()
                        .sort((a, b) => b.importance - a.importance)[0];
                    if (defaultPlayer) {
                        setSelectedPlayerName(defaultPlayer.name);
                    }
                }
            }, [selectedPlayerName, players]);

            let filtered = players.filter(p => p.name);

            filtered = filtered.filter(p => p.minutes >= minMinutes);

            if (positionFilter !== 'all') {
                filtered = filtered.filter(p =>
                    (p.pos || '').split(',').map(s => s.trim()).includes(positionFilter)
                );
            }

            filtered.sort((a, b) => {
                if (sortBy === 'minutes_desc') {
                    return b.minutes - a.minutes;
                }
                if (sortBy === 'rating_desc') {
                    return b.rating - a.rating;
                }
                return b.importance - a.importance;
            });

            const maxMinutes = players.reduce(
                (max, p) => (p.minutes > max ? p.minutes : max),
                0
            );

            const selectedPlayer = players.find(p => p.name === selectedPlayerName) || null;

            const playerMinutesSeries = (() => {
                if (!selectedPlayer || !minutesRows || minutesRows.length === 0) {
                    return [];
                }
                const rowsForPlayer = minutesRows.filter(
                    r =>
                        (r.player || '') === selectedPlayer.name &&
                        String(r.team || '').toLowerCase().includes('lyon')
                );
                return rowsForPlayer.map(r => ({
                    label: r.game || '',
                    minutes: parseInt(r.minutes_played || '0', 10) || 0,
                    goals: parseInt(r.goals || '0', 10) || 0,
                    assists: parseInt(r.assists || '0', 10) || 0,
                    xg: parseFloat(r.xg || '0') || 0,
                    xag: parseFloat(r.xag || '0') || 0
                }));
            })();

            const maxSeriesMinutes = playerMinutesSeries.reduce(
                (max, r) => (r.minutes > max ? r.minutes : max),
                0
            );

            const maxGls90 = players.reduce(
                (max, p) => (p.gls90 > max ? p.gls90 : max),
                0.1
            );
            const maxAst90 = players.reduce(
                (max, p) => (p.ast90 > max ? p.ast90 : max),
                0.1
            );
            const maxXg90 = players.reduce(
                (max, p) => (p.xg90 > max ? p.xg90 : max),
                0.1
            );
            const maxXag90 = players.reduce(
                (max, p) => (p.xag90 > max ? p.xag90 : max),
                0.1
            );
            const maxPrgC = players.reduce(
                (max, p) => (p.prgC > max ? p.prgC : max),
                1
            );
            const maxPrgP = players.reduce(
                (max, p) => (p.prgP > max ? p.prgP : max),
                1
            );
            const maxPrgR = players.reduce(
                (max, p) => (p.prgR > max ? p.prgR : max),
                1
            );

            const getPositionGroup = pos => {
                const value = pos || '';
                if (value.includes('GK')) return 'GK';
                if (value.includes('DF')) return 'DF';
                if (value.includes('MF')) return 'MF';
                return 'FW';
            };

            const buildPositionMetrics = player => {
                const group = getPositionGroup(player.pos || '');
                if (group === 'FW') {
                    return [
                        {
                            icon: 'üìà',
                            label: 'xG/90',
                            value: player.xg90,
                            decimals: 2
                        },
                        {
                            icon: 'üìä',
                            label: 'xAG/90',
                            value: player.xag90,
                            decimals: 2
                        }
                    ];
                }
                if (group === 'MF') {
                    return [
                        {
                            icon: 'üéØ',
                            label: 'Passes D./90',
                            value: player.ast90,
                            decimals: 2
                        },
                        {
                            icon: 'üîÑ',
                            label: 'PrgP',
                            value: player.prgP
                        }
                    ];
                }
                if (group === 'DF') {
                    return [
                        {
                            icon: 'üõ°Ô∏è',
                            label: 'PrgC',
                            value: player.prgC
                        },
                        {
                            icon: 'üö´',
                            label: 'Cartons',
                            value: player.cardsY + player.cardsR
                        }
                    ];
                }
                return [
                    {
                        icon: 'üß§',
                        label: 'Minutes',
                        value: player.minutes
                    },
                    {
                        icon: '‚≠ê',
                        label: 'Note',
                        value: player.rating,
                        decimals: 1
                    }
                ];
            };

            const teamAvgRating =
                players.length > 0
                    ? players.reduce((acc, p) => acc + p.rating, 0) / players.length
                    : 0;
            const teamAvgXg90 =
                players.length > 0
                    ? players.reduce((acc, p) => acc + p.xg90, 0) / players.length
                    : 0;
            const teamAvgXag90 =
                players.length > 0
                    ? players.reduce((acc, p) => acc + p.xag90, 0) / players.length
                    : 0;
            const teamAvgGls90 =
                players.length > 0
                    ? players.reduce((acc, p) => acc + p.gls90, 0) / players.length
                    : 0;

            const renderRadar = player => {
                if (!player) return null;
                const metrics = [
                    {
                        label: 'Buts/90',
                        value: player.gls90,
                        max: maxGls90
                    },
                    {
                        label: 'Passes D./90',
                        value: player.ast90,
                        max: maxAst90
                    },
                    {
                        label: 'xG/90',
                        value: player.xg90,
                        max: maxXg90
                    },
                    {
                        label: 'xAG/90',
                        value: player.xag90,
                        max: maxXag90
                    },
                    {
                        label: 'PrgP',
                        value: player.prgP,
                        max: maxPrgP
                    },
                    {
                        label: 'PrgC',
                        value: player.prgC,
                        max: maxPrgC
                    },
                    {
                        label: 'PrgR',
                        value: player.prgR,
                        max: maxPrgR
                    }
                ];
                const cx = 80;
                const cy = 80;
                const baseRadius = 15;
                const maxRadius = 60;
                const angleStep = (2 * Math.PI) / metrics.length;
                const points = metrics
                    .map((m, index) => {
                        const ratio = m.max > 0 ? Math.min(m.value / m.max, 1) : 0;
                        const radius = baseRadius + ratio * (maxRadius - baseRadius);
                        const angle = Math.PI / 2 - index * angleStep;
                        const x = cx + radius * Math.cos(angle);
                        const y = cy - radius * Math.sin(angle);
                        return `${x},${y}`;
                    })
                    .join(' ');

                return (
                    <div className="rounded-xl bg-slate-900/70 p-4">
                        <p className="text-xs font-medium uppercase tracking-wide text-slate-400 mb-2">
                            Profil radar
                        </p>
                        <div className="flex items-center gap-4">
                            <svg width="160" height="160">
                                <circle
                                    cx={cx}
                                    cy={cy}
                                    r={maxRadius}
                                    fill="none"
                                    stroke="#1f2937"
                                />
                                <circle
                                    cx={cx}
                                    cy={cy}
                                    r={(maxRadius + baseRadius) / 2}
                                    fill="none"
                                    stroke="#111827"
                                />
                                <circle
                                    cx={cx}
                                    cy={cy}
                                    r={baseRadius}
                                    fill="none"
                                    stroke="#111827"
                                />
                                {metrics.map((m, index) => {
                                    const angle = Math.PI / 2 - index * angleStep;
                                    const x = cx + maxRadius * Math.cos(angle);
                                    const y = cy - maxRadius * Math.sin(angle);
                                    return (
                                        <g key={m.label}>
                                            <line
                                                x1={cx}
                                                y1={cy}
                                                x2={x}
                                                y2={y}
                                                stroke="#1f2937"
                                            />
                                        </g>
                                    );
                                })}
                                <polygon
                                    points={points}
                                    fill="rgba(56, 189, 248, 0.35)"
                                    stroke="#38bdf8"
                                    strokeWidth="1.5"
                                />
                            </svg>
                            <div className="grid grid-cols-2 gap-2 text-[11px] text-slate-300">
                                {metrics.map(m => {
                                    const ratio = m.max > 0 ? Math.min(m.value / m.max, 1) : 0;
                                    return (
                                        <div
                                            key={m.label}
                                            className="flex flex-col gap-1"
                                        >
                                            <span className="text-slate-400">
                                                {m.label}
                                            </span>
                                            <div className="flex items-center gap-2">
                                                <div className="h-1.5 flex-1 overflow-hidden rounded-full bg-slate-800">
                                                    <div
                                                        className="h-full rounded-full bg-sky-500"
                                                        style={{
                                                            width: `${ratio * 100}%`
                                                        }}
                                                    />
                                                </div>
                                                <span className="tabular-nums text-slate-200">
                                                    {m.value.toFixed(2)}
                                                </span>
                                            </div>
                                        </div>
                                    );
                                })}
                            </div>
                        </div>
                    </div>
                );
            };

            const handleRowClick = player => {
                setSelectedPlayerName(player.name);
                const anchor = document.getElementById('player-detail-anchor');
                if (anchor && typeof anchor.scrollIntoView === 'function') {
                    anchor.scrollIntoView({ behavior: 'smooth', block: 'start' });
                }
            };

            return (
                <div className="space-y-4">
                    <div id="player-detail-anchor"></div>
                    <div className="grid gap-4 lg:grid-cols-2">
                        <div className="space-y-3 rounded-xl bg-slate-900/70 p-4">
                            <div className="flex items-center justify-between">
                                <p className="text-xs font-medium uppercase tracking-wide text-slate-400">
                                    Vue joueur
                                </p>
                                <span className="text-xs text-slate-500">
                                    Donn√©es saison compl√®tes
                                </span>
                            </div>
                            <select
                                className="mt-2 w-full rounded-md border border-slate-700 bg-slate-900 px-2 py-1 text-xs text-slate-100"
                                value={selectedPlayerName}
                                onChange={e => setSelectedPlayerName(e.target.value)}
                            >
                                <option value="">S√©lectionner un joueur</option>
                                {players
                                    .slice()
                                    .sort((a, b) => b.importance - a.importance)
                                    .map(p => (
                                        <option key={p.name} value={p.name}>
                                            {p.name}
                                        </option>
                                    ))}
                            </select>
                            {selectedPlayer && (
                                <div className="mt-3 space-y-2 rounded-lg bg-slate-900/80 p-3 text-sm">
                                    <div className="flex items-center justify-between">
                                        <div>
                                            <p className="text-sm font-semibold">
                                                {selectedPlayer.name}
                                            </p>
                                            <p className="text-xs text-slate-400">
                                                {selectedPlayer.pos || 'Poste inconnu'}
                                            </p>
                                        </div>
                                        <div className="text-right text-xs text-slate-300">
                                            <p>
                                                Minutes:{' '}
                                                {selectedPlayer.minutes.toLocaleString(
                                                    'fr-FR'
                                                )}
                                            </p>
                                            <p>Note: {selectedPlayer.rating.toFixed(1)}</p>
                                            <p>
                                                Impact:{' '}
                                                {selectedPlayer.importance.toFixed(1)}
                                            </p>
                                        </div>
                                    </div>
                                    <div className="mt-2 grid grid-cols-2 gap-2 text-[11px] text-slate-300">
                                        <div>
                                            <p className="text-slate-400">Buts/90</p>
                                            <p className="font-semibold">
                                                {selectedPlayer.gls90.toFixed(2)}
                                            </p>
                                        </div>
                                        <div>
                                            <p className="text-slate-400">Passes D./90</p>
                                            <p className="font-semibold">
                                                {selectedPlayer.ast90.toFixed(2)}
                                            </p>
                                        </div>
                                        <div>
                                            <p className="text-slate-400">xG/90</p>
                                            <p className="font-semibold">
                                                {selectedPlayer.xg90.toFixed(2)}
                                            </p>
                                        </div>
                                        <div>
                                            <p className="text-slate-400">xAG/90</p>
                                            <p className="font-semibold">
                                                {selectedPlayer.xag90.toFixed(2)}
                                            </p>
                                        </div>
                                    </div>
                                    <div className="mt-3 space-y-2 text-[11px] text-slate-300">
                                        <div className="rounded-md bg-slate-900/60 p-2">
                                            <p className="text-slate-400">
                                                Comparaison avec la moyenne de l'√©quipe
                                            </p>
                                            <div className="mt-1 grid grid-cols-2 gap-2">
                                                <div>
                                                    <p className="text-slate-400">Note</p>
                                                    <p className="tabular-nums">
                                                        {selectedPlayer.rating.toFixed(2)} vs{' '}
                                                        {teamAvgRating.toFixed(2)}
                                                    </p>
                                                </div>
                                                <div>
                                                    <p className="text-slate-400">Buts/90</p>
                                                    <p className="tabular-nums">
                                                        {selectedPlayer.gls90.toFixed(2)} vs{' '}
                                                        {teamAvgGls90.toFixed(2)}
                                                    </p>
                                                </div>
                                                <div>
                                                    <p className="text-slate-400">xG/90</p>
                                                    <p className="tabular-nums">
                                                        {selectedPlayer.xg90.toFixed(2)} vs{' '}
                                                        {teamAvgXg90.toFixed(2)}
                                                    </p>
                                                </div>
                                                <div>
                                                    <p className="text-slate-400">xAG/90</p>
                                                    <p className="tabular-nums">
                                                        {selectedPlayer.xag90.toFixed(2)} vs{' '}
                                                        {teamAvgXag90.toFixed(2)}
                                                    </p>
                                                </div>
                                            </div>
                                        </div>
                                        <div className="rounded-md bg-slate-900/60 p-2">
                                            <p className="text-slate-400">
                                                Impact algorithme et combos
                                            </p>
                                            {(() => {
                                                const name = selectedPlayer.name || '';
                                                const impactMatch =
                                                    (impactMatchRows || []).find(
                                                        r =>
                                                            (r.player || '') === name
                                                    ) || null;
                                                const absenceImpact =
                                                    (absenceImpactRows || []).find(
                                                        r =>
                                                            (r.player || '') === name
                                                    ) || null;
                                                const impactScore =
                                                    (impactScoreRows || []).find(
                                                        r =>
                                                            (r.name || '') === name
                                                    ) || null;
                                                const combos =
                                                    (comboImpactRows || [])
                                                        .filter(r =>
                                                            String(r.combo || '').includes(
                                                                name
                                                            )
                                                        )
                                                        .slice(0, 3);
                                                return (
                                                    <div className="mt-1 space-y-1">
                                                        {impactScore && (
                                                            <p>
                                                                Score impact global:{' '}
                                                                <span className="tabular-nums">
                                                                    {parseFloat(
                                                                        impactScore.impact_score ||
                                                                            '0'
                                                                    ).toFixed(1)}
                                                                </span>{' '}
                                                                (
                                                                {impactScore.impact_category ||
                                                                    ''}
                                                                )
                                                            </p>
                                                        )}
                                                        {impactMatch && (
                                                            <p>
                                                                Points/match:{' '}
                                                                {parseFloat(
                                                                    impactMatch.points_per_match_with ||
                                                                        '0'
                                                                ).toFixed(2)}{' '}
                                                                avec vs{' '}
                                                                {parseFloat(
                                                                    impactMatch.points_per_match_without ||
                                                                        '0'
                                                                ).toFixed(2)}{' '}
                                                                sans
                                                            </p>
                                                        )}
                                                        {absenceImpact && (
                                                            <p>
                                                                Note √©quipe:{' '}
                                                                {parseFloat(
                                                                    absenceImpact.rating_with ||
                                                                        '0'
                                                                ).toFixed(2)}{' '}
                                                                avec vs{' '}
                                                                {parseFloat(
                                                                    absenceImpact.rating_without ||
                                                                        '0'
                                                                ).toFixed(2)}{' '}
                                                                sans (
                                                                {parseFloat(
                                                                    absenceImpact.impact_points ||
                                                                        '0'
                                                                ).toFixed(2)}{' '}
                                                                pts)
                                                            </p>
                                                        )}
                                                        {combos.length > 0 && (
                                                            <div>
                                                                <p className="text-slate-400">
                                                                    Combos les plus performants
                                                                </p>
                                                                <ul className="mt-1 space-y-1">
                                                                    {combos.map((c, idx) => (
                                                                        <li
                                                                            key={
                                                                                c.combo ||
                                                                                idx
                                                                            }
                                                                        >
                                                                            <span className="text-slate-300">
                                                                                {String(
                                                                                    c.combo ||
                                                                                        ''
                                                                                ).replace(
                                                                                    name,
                                                                                    name.toUpperCase()
                                                                                )}
                                                                            </span>{' '}
                                                                            ‚Äì{' '}
                                                                            <span className="tabular-nums">
                                                                                {parseInt(
                                                                                    c.matches ||
                                                                                        '0',
                                                                                    10
                                                                                ) || 0}
                                                                            </span>{' '}
                                                                            matchs,{' '}
                                                                            <span className="tabular-nums">
                                                                                {parseFloat(
                                                                                    c.avg_points ||
                                                                                        c.avg_score ||
                                                                                        '0'
                                                                                ).toFixed(
                                                                                    2
                                                                                )}
                                                                            </span>{' '}
                                                                            pts/match
                                                                        </li>
                                                                    ))}
                                                                </ul>
                                                            </div>
                                                        )}
                                                        {!impactScore &&
                                                            !impactMatch &&
                                                            !absenceImpact &&
                                                            combos.length === 0 && (
                                                                <p className="text-slate-500">
                                                                    Aucun impact calcul√©
                                                                    disponible pour ce joueur.
                                                                </p>
                                                            )}
                                                    </div>
                                                );
                                            })()}
                                        </div>
                                    </div>
                                </div>
                            )}
                        </div>
                        <div className="space-y-3">
                            {renderRadar(selectedPlayer)}
                            <div className="rounded-xl bg-slate-900/70 p-4">
                                <p className="text-xs font-medium uppercase tracking-wide text-slate-400 mb-2">
                                    √âvolution match par match (minutes)
                                </p>
                                {playerMinutesSeries.length === 0 && (
                                    <p className="text-xs text-slate-500">
                                        Aucune donn√©e minute par minute disponible pour ce
                                        joueur.
                                    </p>
                                )}
                                {playerMinutesSeries.length > 0 && (
                                    <div className="flex h-32 items-end gap-1">
                                        {playerMinutesSeries.map((m, idx) => {
                                            const ratio =
                                                maxSeriesMinutes > 0
                                                    ? m.minutes / maxSeriesMinutes
                                                    : 0;
                                            return (
                                                <div
                                                    key={idx}
                                                    className="flex-1"
                                                    title={`${m.label} ‚Ä¢ ${m.minutes} min ‚Ä¢ xG ${m.xg.toFixed(2)} ‚Ä¢ xAG ${m.xag.toFixed(2)}`}
                                                >
                                                    <div className="flex h-full flex-col justify-end">
                                                        <div className="mx-auto h-full w-2 rounded-full bg-slate-800">
                                                            <div
                                                                className="w-full rounded-full bg-emerald-500"
                                                                style={{
                                                                    height: `${Math.max(
                                                                        ratio * 100,
                                                                        3
                                                                    )}%`
                                                                }}
                                                            />
                                                        </div>
                                                    </div>
                                                </div>
                                            );
                                        })}
                                    </div>
                                )}
                            </div>
                        </div>
                    </div>
                    <div className="flex flex-wrap gap-3 rounded-xl bg-slate-900/60 p-4">
                        <div className="flex flex-col text-sm text-slate-200">
                            <label className="mb-1 text-xs text-slate-400">
                                Minutes minimum
                            </label>
                            <input
                                type="number"
                                min="0"
                                className="w-28 rounded-md border border-slate-700 bg-slate-900 px-2 py-1 text-xs"
                                value={minMinutes}
                                onChange={e =>
                                    setMinMinutes(
                                        Number.isNaN(parseInt(e.target.value, 10))
                                            ? 0
                                            : parseInt(e.target.value, 10)
                                    )
                                }
                            />
                        </div>
                        <div className="flex flex-col text-sm text-slate-200">
                            <label className="mb-1 text-xs text-slate-400">
                                Position
                            </label>
                            <select
                                className="rounded-md border border-slate-700 bg-slate-900 px-2 py-1 text-xs"
                                value={positionFilter}
                                onChange={e => setPositionFilter(e.target.value)}
                            >
                                <option value="all">Toutes</option>
                                {distinctPositions.map(pos => (
                                    <option key={pos} value={pos}>
                                        {pos}
                                    </option>
                                ))}
                            </select>
                        </div>
                        <div className="flex flex-col text-sm text-slate-200">
                            <label className="mb-1 text-xs text-slate-400">
                                Tri
                            </label>
                            <select
                                className="rounded-md border border-slate-700 bg-slate-900 px-2 py-1 text-xs"
                                value={sortBy}
                                onChange={e => setSortBy(e.target.value)}
                            >
                                <option value="importance_desc">
                                    Importance d√©croissante
                                </option>
                                <option value="minutes_desc">
                                    Minutes jou√©es d√©croissantes
                                </option>
                                <option value="rating_desc">
                                    Note d√©croissante
                                </option>
                            </select>
                        </div>
                    </div>
                    <div className="table-container">
                        <table id="players-table">
                            <thead>
                                <tr>
                                    <th>Joueur</th>
                                    <th>Position</th>
                                    <th>Temps de Jeu (min)</th>
                                    <th>Note</th>
                                    <th>Importance</th>
                                    <th>Buts / Passes</th>
                                    <th>Stat poste 1</th>
                                    <th>Stat poste 2</th>
                                </tr>
                            </thead>
                            <tbody>
                                {filtered.map(player => {
                                    const metrics = buildPositionMetrics(player);
                                    return (
                                        <tr
                                            key={player.name}
                                            style={{ cursor: 'pointer' }}
                                            onClick={() => handleRowClick(player)}
                                        >
                                            <td>{player.name}</td>
                                            <td>{player.pos}</td>
                                            <td>
                                                {player.minutes.toLocaleString('fr-FR')}
                                            </td>
                                            <td>{player.rating.toFixed(1)}</td>
                                            <td>
                                                <div className="flex items-center gap-2">
                                                    <span>
                                                        {player.importance.toFixed(2)}
                                                    </span>
                                                    {maxMinutes > 0 && (
                                                        <div className="h-1.5 w-24 overflow-hidden rounded-full bg-slate-800">
                                                            <div
                                                                className="h-full rounded-full bg-emerald-500"
                                                                style={{
                                                                    width: `${Math.min(
                                                                        (player.minutes /
                                                                            maxMinutes) *
                                                                            100,
                                                                        100
                                                                    )}%`
                                                                }}
                                                            />
                                                        </div>
                                                    )}
                                                </div>
                                            </td>
                                            <td>
                                                <div className="flex items-center gap-2">
                                                    <span className="text-emerald-400">
                                                        ‚öΩ {player.goals}
                                                    </span>
                                                    <span className="text-sky-400">
                                                        üéØ {player.assists}
                                                    </span>
                                                </div>
                                            </td>
                                            <td>
                                                {metrics[0] && (
                                                    <div className="flex items-center gap-2 text-xs">
                                                        <span>{metrics[0].icon}</span>
                                                        <span className="text-slate-400">
                                                            {metrics[0].label}
                                                        </span>
                                                        <span className="tabular-nums">
                                                            {typeof metrics[0].decimals ===
                                                            'number'
                                                                ? metrics[0].value.toFixed(
                                                                      metrics[0].decimals
                                                                  )
                                                                : metrics[0].value.toLocaleString(
                                                                      'fr-FR'
                                                                  )}
                                                        </span>
                                                    </div>
                                                )}
                                            </td>
                                            <td>
                                                {metrics[1] && (
                                                    <div className="flex items-center gap-2 text-xs">
                                                        <span>{metrics[1].icon}</span>
                                                        <span className="text-slate-400">
                                                            {metrics[1].label}
                                                        </span>
                                                        <span className="tabular-nums">
                                                            {typeof metrics[1].decimals ===
                                                            'number'
                                                                ? metrics[1].value.toFixed(
                                                                      metrics[1].decimals
                                                                  )
                                                                : metrics[1].value.toLocaleString(
                                                                      'fr-FR'
                                                                  )}
                                                        </span>
                                                    </div>
                                                )}
                                            </td>
                                        </tr>
                                    );
                                })}
                                {filtered.length === 0 && (
                                    <tr>
                                        <td colSpan="8" className="loading">
                                            Aucun joueur ne correspond aux filtres
                                        </td>
                                    </tr>
                                )}
                            </tbody>
                        </table>
                    </div>
                </div>
            );
        }

        function MercatoReactView() {
            const a = useCsvData('data/processed/ol_mercato.csv');
            const b = useCsvData('data/processed/ol_transfers_official.csv');
            const c = useCsvData('data/processed/ol_news.csv');
            const s = useCsvData('data/processed/ol_squad_transfermarkt.csv');
            const loading = a.loading || b.loading || c.loading || s.loading;
            const error = a.error || b.error || c.error || s.error;
            const rows = a.rows || [];
            const transfersRows = b.rows || [];
            const newsRows = c.rows || [];
            const squadRows = s.rows || [];
            const [seasonFilter, setSeasonFilter] = useState('current');
            const [windowFilter, setWindowFilter] = useState('all');
            const [loanFilter, setLoanFilter] = useState('all');
            const [sortMode, setSortMode] = useState('date_desc');

            if (loading) {
                return (
                    <div className="table-container">
                        <div className="loading">Chargement du mercato...</div>
                    </div>
                );
            }

            if (error) {
                return (
                    <div className="table-container">
                        <div className="error">Erreur lors du chargement: {error}</div>
                    </div>
                );
            }

            const uniqueByUrl = new Map();
            (rows || []).forEach(r => {
                const key = r.url || r.headline || '';
                if (!uniqueByUrl.has(key)) uniqueByUrl.set(key, r);
            });
            const mercatos = Array.from(uniqueByUrl.values()).map(r => ({
                date: r.date || '',
                headline: r.headline || r.title || '',
                category: (r.category || 'rumor').toLowerCase(),
                direction: (r.direction || 'unknown').toLowerCase(),
                url: r.url || '',
                source: r.source || "L'Equipe"
            }));

            const eqOfficials = mercatos.filter(m => m.category === 'official');
            const eqByKey = new Map();
            eqOfficials.forEach(o => {
                const key = o.url || o.headline || '';
                if (key && !eqByKey.has(key)) {
                    eqByKey.set(key, o);
                }
            });

            const squadById = new Map();
            (squadRows || []).forEach(r => {
                const id = String(r.id || '').trim();
                const name = r.name || '';
                const position = r.position || '';
                const joinedOn = r.joinedOn || '';
                if (id && name && !squadById.has(id)) {
                    squadById.set(id, { name, position, joinedOn });
                }
            });

            const extractPlayerIdFromUrl = (url) => {
                if (!url) return '';
                const m = String(url).match(/spieler\/(\d+)/);
                return m ? m[1] : '';
            };

            const officialData = (transfersRows || []).map(r => {
                const url = r.url || '';
                const id = extractPlayerIdFromUrl(url);
                const squadInfo = id && squadById.has(id) ? squadById.get(id) : null;
                const playerName = squadInfo ? squadInfo.name : '';
                const playerPosition = squadInfo ? squadInfo.position : '';
                const key = url || (playerName || r.headline || '');

                let date = r.date || '';
                if (!date && key && eqByKey.has(key)) {
                    const eq = eqByKey.get(key);
                    if (eq && eq.date) {
                        date = eq.date;
                    }
                }
                if (!date && squadInfo && squadInfo.joinedOn) {
                    date = squadInfo.joinedOn;
                }

                return {
                    date,
                    headline: playerName || r.headline || '',
                    playerName: playerName || '',
                    position: playerPosition,
                    category: 'official',
                    direction: (r.direction || 'unknown').toLowerCase(),
                    url,
                    source: r.source || 'Transfermarkt',
                    fee: r.fee || ''
                };
            });
            const officialKeySet = new Set(
                officialData
                    .map(o => o.url || o.headline || '')
                    .filter(k => k)
            );
            const extraOfficials = eqOfficials
                .filter(o => {
                    const key = o.url || o.headline || '';
                    if (!key) return true;
                    return !officialKeySet.has(key);
                })
                .map(o => ({
                    date: o.date || '',
                    headline: o.headline || '',
                    category: 'official',
                    direction: (o.direction || 'unknown').toLowerCase(),
                    url: o.url || '',
                    source: o.source || "L'Equipe",
                    fee: '',
                    position: ''
                }));

            const combinedOfficialData = [...officialData, ...extraOfficials];

            const toSeason = (dStr) => {
                if (!dStr) return '';
                const d = new Date(dStr);
                if (isNaN(d.getTime())) return '';
                const y = d.getUTCFullYear();
                const m = d.getUTCMonth() + 1;
                const start = m >= 7 ? y : y - 1;
                const endShort = String((start + 1) % 100).padStart(2, '0');
                return `${start}-${endShort}`;
            };

            const getWindow = (dStr) => {
                if (!dStr) return '';
                const d = new Date(dStr);
                if (isNaN(d.getTime())) return '';
                const m = d.getUTCMonth() + 1;
                if (m === 1) return 'winter';
                if (m >= 7 && m <= 9) return 'summer';
                return '';
            };

            const isLoanTransfer = (fee) => {
                if (!fee) return false;
                const f = String(fee).toLowerCase();
                if (f.includes('end of loan')) return false;
                return f.includes('loan');
            };

            const parseFeeValue = (fee) => {
                if (!fee) return 0;
                const lower = String(fee).toLowerCase();
                if (lower.includes('free')) return 0;
                if (lower === '-' || lower.includes('end of loan')) return 0;
                const cleaned = fee.replace(/,/g, '');
                const match = cleaned.match(/([0-9]+(?:\.[0-9]+)?)\s*([mk]?)/i);
                if (!match) return 0;
                let value = parseFloat(match[1]);
                const unit = match[2].toLowerCase();
                if (unit === 'm') value *= 1000000;
                else if (unit === 'k') value *= 1000;
                if (!Number.isFinite(value)) return 0;
                return value;
            };

            const translatePosition = (position) => {
                const p = String(position || '').toLowerCase();
                if (p === 'goalkeeper') return 'Gardien de but';
                if (p === 'centre-back' || p === 'center-back') return 'D√©fenseur central';
                if (p === 'left-back') return 'Arri√®re gauche';
                if (p === 'right-back') return 'Arri√®re droit';
                if (p === 'defensive midfield') return 'Milieu d√©fensif';
                if (p === 'central midfield') return 'Milieu central';
                if (p === 'attacking midfield') return 'Milieu offensif';
                if (p === 'left winger') return 'Ailier gauche';
                if (p === 'right winger') return 'Ailier droit';
                if (p === 'centre-forward' || p === 'center-forward') return 'Avant-centre';
                if (p === 'second striker') return 'Second attaquant';
                return position || '';
            };

            const seasonsSet = new Set(
                combinedOfficialData
                    .map(o => toSeason(o.date))
                    .filter(s => s)
            );
            const seasons = Array.from(seasonsSet).sort((a, b) => b.localeCompare(a));
            const now = new Date();
            const currentStart = (now.getUTCMonth() + 1) >= 7 ? now.getUTCFullYear() : now.getUTCFullYear() - 1;
            const currentLabel = `${currentStart}-${String((currentStart + 1) % 100).padStart(2, '0')}`;
            const effectiveSeason = seasonFilter === 'current' ? currentLabel : seasonFilter;

            const applySeasonFilter = (arr) => {
                if (!effectiveSeason) return arr;
                return arr.filter(o => {
                    const s = toSeason(o.date);
                    if (s) return s === effectiveSeason;
                    return seasonFilter === 'current';
                });
            };

            const applyWindowFilter = (arr) => {
                if (windowFilter === 'all') return arr;
                return arr.filter(o => {
                    const w = getWindow(o.date);
                    if (!w) return windowFilter === 'all';
                    return w === windowFilter;
                });
            };

            const applyLoanFilter = (arr) => {
                if (loanFilter === 'all') return arr;
                return arr.filter(o => {
                    const isLoan = isLoanTransfer(o.fee);
                    if (loanFilter === 'loans_only') return isLoan;
                    if (loanFilter === 'no_loans') return !isLoan;
                    return true;
                });
            };

            const sortOfficial = (arr) => {
                const copy = [...arr];
                if (sortMode === 'fee_desc') {
                    return copy.sort((a, b) => parseFeeValue(b.fee) - parseFeeValue(a.fee));
                }
                if (sortMode === 'fee_asc') {
                    return copy.sort((a, b) => parseFeeValue(a.fee) - parseFeeValue(b.fee));
                }
                return copy.sort((a, b) => (b.date || '').localeCompare(a.date || ''));
            };

            const filterOfficial = (arr) => {
                return sortOfficial(
                    applyLoanFilter(
                        applyWindowFilter(
                            applySeasonFilter(arr)
                        )
                    )
                );
            };

            const officialIn = combinedOfficialData.filter(m => m.direction === 'in');
            const officialOut = combinedOfficialData.filter(m => m.direction === 'out');
            const officialInFiltered = filterOfficial(officialIn);
            const officialOutFiltered = filterOfficial(officialOut);
            const officialAllFiltered = filterOfficial(combinedOfficialData);
            const rumors = mercatos.filter(m => m.category !== 'official');
            const news = (newsRows || []).map(r => ({
                date: r.date || '',
                headline: r.headline || r.title || '',
                url: r.url || '',
                source: r.source || 'O&L'
            }));
            const hasAny = officialAllFiltered.length + rumors.length + news.length > 0;
            const officialSourceLabel = combinedOfficialData.length > 0 ? combinedOfficialData[0].source : 'Transfermarkt';

            const renderItem = m => {
                const dateLabel = m.date ? formatDate(m.date) : '';
                const directionLabel =
                    m.direction === 'in'
                        ? 'Arriv√©e'
                        : m.direction === 'out'
                        ? 'D√©part'
                        : '';
                const categoryLabel =
                    m.category === 'official' ? 'Officiel' : 'Rumeur';
                return (
                    <li
                        key={
                            m.url ||
                            m.headline + m.date + m.category + m.direction
                        }
                        className="rounded-lg border border-slate-700 bg-slate-900/70 px-3 py-2 text-xs"
                    >
                        <div className="flex items-center justify-between gap-2">
                            <div className="flex flex-col">
                                <span className="text-[11px] text-slate-300">
                                    {dateLabel || ''}
                                </span>
                                <span className="text-[11px] text-slate-400">
                                    {categoryLabel}
                                    {directionLabel
                                        ? ` ¬∑ ${directionLabel}`
                                        : ''}
                                </span>
                            </div>
                            {m.source && (
                                <span className="text-[10px] text-slate-500">
                                    {m.source}
                                </span>
                            )}
                        </div>
                        <div className="mt-1 text-[12px] text-slate-100">
                            {m.url ? (
                                <a
                                    href={m.url}
                                    target="_blank"
                                    rel="noreferrer"
                                    className="hover:underline"
                                >
                                    {m.headline || m.url}
                                </a>
                            ) : (
                                m.headline || 'Article'
                            )}
                        </div>
                        {m.fee && (
                            <div className="mt-1 text-[11px] text-slate-300">
                                {m.fee}
                            </div>
                        )}
                    </li>
                );
            };

            if (!hasAny) {
                return (
                    <div className="table-container">
                        <div className="loading">
                            Aucune donn√©e mercato disponible.
                        </div>
                    </div>
                );
            }

            const officialTimeline = officialAllFiltered
                .slice()
                .sort((a, b) => (b.date || '').localeCompare(a.date || ''));

            const formatAmountShort = (value) => {
                const v = Number(value) || 0;
                if (v === 0) return '';
                if (v >= 1000000) {
                    return (v / 1000000).toFixed(2) + ' M‚Ç¨';
                }
                if (v >= 1000) {
                    return (v / 1000).toFixed(1) + ' k‚Ç¨';
                }
                return Math.round(v).toLocaleString('fr-FR') + ' ‚Ç¨';
            };

            const officialAllWithParsed = officialAllFiltered.map(o => {
                const amount = parseFeeValue(o.fee);
                return { ...o, amount };
            });

            const officialInWithParsed = officialInFiltered.map(o => {
                const amount = parseFeeValue(o.fee);
                return { ...o, amount };
            });

            const officialOutWithParsed = officialOutFiltered.map(o => {
                const amount = parseFeeValue(o.fee);
                return { ...o, amount };
            });

            return (
                <div className="space-y-4">
                    <div className="rounded-xl bg-slate-900/70 p-4">
                        <h3 className="text-sm font-semibold text-slate-100">
                            Chronologie du mercato OL ({officialSourceLabel})
                        </h3>
                        <div className="mt-3 flex gap-3 overflow-x-auto pb-2">
                            {officialTimeline.map(m => {
                                const dateLabel = m.date ? formatDate(m.date) : '';
                                const directionShort =
                                    m.direction === 'in'
                                        ? 'Arriv√©e'
                                        : m.direction === 'out'
                                        ? 'D√©part'
                                        : '';
                                const w = getWindow(m.date);
                                const windowLabel =
                                    w === 'summer' ? '√ât√©' : w === 'winter' ? 'Hiver' : '';
                                const isLoan = isLoanTransfer(m.fee);
                                const typeLabel = isLoan ? 'Pr√™t' : 'Transfert';
                                const amountValue = parseFeeValue(m.fee);
                                const amountShort = formatAmountShort(amountValue);
                                const cardStatusClass =
                                    m.direction === 'out'
                                        ? 'border-red-500/60 bg-red-900/40'
                                        : 'border-slate-700 bg-slate-900/80';
                                return (
                                    <div
                                        key={m.url || m.headline + m.date + m.direction}
                                        className={`min-w-[190px] rounded-lg border px-3 py-2 text-xs ${cardStatusClass}`}
                                    >
                                        <div className="flex items-center justify-between">
                                            <div className="flex flex-col">
                                                <span className="font-semibold text-slate-100">
                                                    {directionShort || 'Mouvement'}
                                                </span>
                                                {windowLabel && (
                                                    <span className="text-[10px] text-slate-300">
                                                        {windowLabel}
                                                    </span>
                                                )}
                                            </div>
                                            <span className="text-[10px] text-slate-200">
                                                {dateLabel}
                                            </span>
                                        </div>
                                        <div className="mt-1 text-[11px] text-slate-100">
                                            {m.headline || m.url || 'Transfert'}
                                        </div>
                                        <div className="mt-1 flex items-center justify-between text-[10px] text-slate-200">
                                            <span>
                                                {typeLabel}
                                                {isLoan ? '' : amountShort ? ' ¬∑ ' + amountShort : ''}
                                            </span>
                                            <span className="text-slate-400">
                                                {m.source || ''}
                                            </span>
                                        </div>
                                    </div>
                                );
                            })}
                            {officialTimeline.length === 0 && (
                                <div className="text-xs text-slate-400">
                                    Aucun mouvement officiel pour les filtres s√©lectionn√©s.
                                </div>
                            )}
                        </div>
                    </div>
                    <div className="flex flex-wrap gap-3 rounded-xl bg-slate-900/70 p-4">
                        <div className="flex flex-col text-sm text-slate-200">
                            <label className="mb-1 text-xs text-slate-400">Saison</label>
                            <select
                                className="rounded-md border border-slate-700 bg-slate-900 px-2 py-1 text-xs"
                                value={seasonFilter}
                                onChange={e => setSeasonFilter(e.target.value)}
                            >
                                <option value="current">Courante ({currentLabel})</option>
                                {seasons.map(s => (
                                    <option key={s} value={s}>{s}</option>
                                ))}
                                <option value="">Toutes</option>
                            </select>
                        </div>
                        <div className="flex flex-col text-sm text-slate-200">
                            <label className="mb-1 text-xs text-slate-400">Fen√™tre</label>
                            <select
                                className="rounded-md border border-slate-700 bg-slate-900 px-2 py-1 text-xs"
                                value={windowFilter}
                                onChange={e => setWindowFilter(e.target.value)}
                            >
                                <option value="all">Toutes</option>
                                <option value="summer">√ât√©</option>
                                <option value="winter">Hiver</option>
                            </select>
                        </div>
                        <div className="flex flex-col text-sm text-slate-200">
                            <label className="mb-1 text-xs text-slate-400">Pr√™ts</label>
                            <select
                                className="rounded-md border border-slate-700 bg-slate-900 px-2 py-1 text-xs"
                                value={loanFilter}
                                onChange={e => setLoanFilter(e.target.value)}
                            >
                                <option value="all">Tous</option>
                                <option value="loans_only">Pr√™ts uniquement</option>
                                <option value="no_loans">Sans pr√™ts</option>
                            </select>
                        </div>
                        <div className="flex flex-col text-sm text-slate-200">
                            <label className="mb-1 text-xs text-slate-400">Tri</label>
                            <select
                                className="rounded-md border border-slate-700 bg-slate-900 px-2 py-1 text-xs"
                                value={sortMode}
                                onChange={e => setSortMode(e.target.value)}
                            >
                                <option value="date_desc">Date d√©croissante</option>
                                <option value="fee_desc">Prix d√©croissant</option>
                                <option value="fee_asc">Prix croissant</option>
                            </select>
                        </div>
                    </div>
                    <div className="grid grid-cols-1 gap-4 lg:grid-cols-2">
                        <div className="table-container">
                            <h3 className="text-sm font-semibold text-slate-100 mb-2">
                                Arriv√©es officielles
                            </h3>
                            <table id="mercato-in-table">
                                <thead>
                                    <tr>
                                        <th>Date</th>
                                        <th>Libell√©</th>
                                        <th>Poste</th>
                                        <th>Type</th>
                                        <th>Montant (approx.)</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    {officialInWithParsed.map(m => {
                                        const dateLabel = m.date ? formatDate(m.date) : '';
                                        const isLoan = isLoanTransfer(m.fee);
                                        const typeLabel = isLoan ? 'Pr√™t' : 'Transfert';
                                        const amountShort = formatAmountShort(m.amount);
                                        return (
                                            <tr
                                                key={
                                                    'in-' +
                                                    (m.url ||
                                                        m.headline +
                                                            m.date +
                                                            (m.source || ''))
                                                }
                                            >
                                                <td>{dateLabel}</td>
                                                <td>{m.headline || m.url || 'Transfert'}</td>
                                                <td>{translatePosition(m.position)}</td>
                                                <td>{typeLabel}</td>
                                                <td>{amountShort || m.fee || '-'}</td>
                                            </tr>
                                        );
                                    })}
                                    {officialInWithParsed.length === 0 && (
                                        <tr>
                                            <td colSpan="5" className="loading">
                                                Aucune arriv√©e ne correspond aux filtres
                                            </td>
                                        </tr>
                                    )}
                                </tbody>
                            </table>
                        </div>
                        <div className="table-container">
                            <h3 className="text-sm font-semibold text-slate-100 mb-2">
                                D√©parts officiels
                            </h3>
                            <table id="mercato-out-table">
                                <thead>
                                    <tr>
                                        <th>Date</th>
                                        <th>Libell√©</th>
                                        <th>Poste</th>
                                        <th>Type</th>
                                        <th>Montant (approx.)</th>
                                    </tr>
                                </thead>
                                <tbody className="text-red-300">
                                    {officialOutWithParsed.map(m => {
                                        const dateLabel = m.date ? formatDate(m.date) : '';
                                        const isLoan = isLoanTransfer(m.fee);
                                        const typeLabel = isLoan ? 'Pr√™t' : 'Transfert';
                                        const amountShort = formatAmountShort(m.amount);
                                        return (
                                            <tr
                                                className="border border-red-500/60 bg-red-900/20"
                                                key={
                                                    'out-' +
                                                    (m.url ||
                                                        m.headline +
                                                            m.date +
                                                            (m.source || ''))
                                                }
                                            >
                                                <td>{dateLabel}</td>
                                                <td>{m.headline || m.url || 'Transfert'}</td>
                                                <td>{translatePosition(m.position)}</td>
                                                <td>{typeLabel}</td>
                                                <td>{amountShort || m.fee || '-'}</td>
                                            </tr>
                                        );
                                    })}
                                    {officialOutWithParsed.length === 0 && (
                                        <tr>
                                            <td colSpan="5" className="loading">
                                                Aucun d√©part ne correspond aux filtres
                                            </td>
                                        </tr>
                                    )}
                                </tbody>
                            </table>
                        </div>
                    </div>
                    <div className="grid grid-cols-1 gap-4 lg:grid-cols-1">
                        <div className="rounded-xl bg-slate-900/70 p-4">
                            <h3 className="text-sm font-semibold text-slate-100">
                                Rumeurs (L‚Äô√âquipe)
                            </h3>
                            <ul className="mt-3 space-y-2">
                                {rumors.length > 0 ? (
                                    rumors.map(renderItem)
                                ) : (
                                    <li className="text-xs text-slate-400">
                                        Aucune rumeur r√©cente d√©tect√©e.
                                    </li>
                                )}
                            </ul>
                        </div>
                    </div>
                </div>
            );
        }

        function NewsReactView() {
            const { loading, error, rows } = useCsvData('data/processed/ol_news.csv');
            if (loading) {
                return (
                    <div className="table-container">
                        <div className="loading">Chargement des actualit√©s...</div>
                    </div>
                );
            }
            if (error) {
                return (
                    <div className="table-container">
                        <div className="error">Erreur lors du chargement des actualit√©s: {error}</div>
                    </div>
                );
            }
            const articles = (rows || []).map(r => ({
                date: r.date || '',
                headline: r.headline || r.title || '',
                url: r.url || '',
                source: r.source || 'O&L'
            }));
            const renderItem = (a, idx) => {
                const dateLabel = a.date ? formatDate(a.date) : '';
                return (
                    <li
                        key={`${a.url || a.headline || 'item'}-${idx}`}
                        className="rounded-lg border border-slate-700 bg-slate-900/70 px-3 py-2 text-xs"
                    >
                        <div className="flex items-center justify-between gap-2">
                            <span className="text-[11px] text-slate-300">{dateLabel || ''}</span>
                            <span className="text-[10px] text-slate-500">{a.source}</span>
                        </div>
                        <div className="mt-1 text-[12px] text-slate-100">
                            <a href={a.url} target="_blank" rel="noreferrer" className="hover:underline">
                                {a.headline || a.url}
                            </a>
                        </div>
                    </li>
                );
            };
            return (
                <div className="space-y-4">
                    <div className="rounded-xl bg-slate-900/70 p-4">
                        <h3 className="text-sm font-semibold text-slate-100">Actualit√©s OL (O&L)</h3>
                        <ul className="mt-3 space-y-2">
                            {articles.length > 0 ? (
                                articles.map((a, idx) => renderItem(a, idx))
                            ) : (
                                <li className="text-xs text-slate-400">Aucune actualit√© disponible.</li>
                            )}
                        </ul>
                    </div>
                </div>
            );
        }

        function CombosAdvancedReactView() {
            const { loading, error, rows } = useCsvData(
                'data/processed/ol_best_combos_ALL_3_to_11.csv'
            );
            const [minMatches, setMinMatches] = useState(3);
            const [playerFilter, setPlayerFilter] = useState('');
            const [sizeFilter, setSizeFilter] = useState('all');
            const [sortBy, setSortBy] = useState('points_desc');

            if (loading) {
                return (
                    <div className="mt-4 rounded-2xl border border-slate-700 bg-slate-900/80 px-6 py-4 text-slate-100">
                        Chargement des combinaisons avanc√©es...
                    </div>
                );
            }

            if (error) {
                return (
                    <div className="mt-4 rounded-2xl border border-red-500/60 bg-red-900/40 px-6 py-4 text-sm text-red-100">
                        Erreur lors du chargement des combinaisons: {error}
                    </div>
                );
            }

            const combos = (rows || [])
                .map(c => ({
                    name: c.combo,
                    size:
                        parseInt(c.size || c.combo_size || '0', 10) ||
                        0,
                    matches: parseInt(c.matches || '0', 10) || 0,
                    avgPoints: parseFloat(c.avg_points || '0') || 0,
                    avgScoreFinal:
                        parseFloat(c.avg_score_final || '0') || 0
                }))
                .filter(c => c.name);

            const availableSizes = Array.from(
                new Set(
                    combos
                        .map(c => c.size)
                        .filter(size => Number.isFinite(size) && size > 0)
                )
            ).sort((a, b) => a - b);

            const normalizedFilter = playerFilter
                .normalize('NFD')
                .replace(/[\u0300-\u036f]/g, '')
                .toLowerCase();

            let filtered = combos.filter(c => c.matches >= minMatches);

            if (normalizedFilter) {
                filtered = filtered.filter(c =>
                    c.name
                        .normalize('NFD')
                        .replace(/[\u0300-\u036f]/g, '')
                        .toLowerCase()
                        .includes(normalizedFilter)
                );
            }

            if (sizeFilter !== 'all') {
                const sizeNumber = parseInt(sizeFilter, 10) || 0;
                if (sizeNumber > 0) {
                    filtered = filtered.filter(c => c.size === sizeNumber);
                }
            }

            filtered.sort((a, b) => {
                if (sortBy === 'score_desc') {
                    return b.avgScoreFinal - a.avgScoreFinal;
                }
                if (sortBy === 'matches_desc') {
                    return b.matches - a.matches;
                }
                return b.avgPoints - a.avgPoints;
            });

            const displayed = filtered.slice(0, 30);

            const maxAvgPoints = filtered.reduce(
                (max, c) => (c.avgPoints > max ? c.avgPoints : max),
                0
            );

            const bestCombo = filtered[0];

            if (!combos.length) {
                return (
                    <div className="mt-4 rounded-2xl border border-slate-700 bg-slate-900/80 px-6 py-4 text-slate-100">
                        Aucune combinaison disponible.
                    </div>
                );
            }

            return (
                <div className="mt-6 space-y-6 rounded-2xl border border-slate-700 bg-slate-900/80 p-6 text-slate-100">
                    <div className="flex flex-col gap-4 md:flex-row md:items-baseline md:justify-between">
                        <div>
                            <p className="text-xs uppercase tracking-wide text-slate-400">
                                Combinaisons de 2 √† 11 joueurs
                            </p>
                            <h3 className="text-lg font-semibold">
                                Vue avanc√©e des combinaisons OL
                            </h3>
                            <p className="mt-1 text-xs text-slate-400">
                                Filtrez par joueur, nombre de matchs et m√©triques avanc√©es.
                            </p>
                        </div>
                        <div className="text-right text-xs text-slate-400">
                            <p>Total de combinaisons: {combos.length}</p>
                            <p>Affich√©es: {displayed.length}</p>
                        </div>
                    </div>

                    {bestCombo && (
                        <div className="grid gap-4 rounded-xl bg-slate-900/70 p-4 md:grid-cols-3">
                            <div className="md:col-span-2">
                                <p className="text-xs uppercase tracking-wide text-amber-400">
                                    Meilleure combinaison actuelle
                                </p>
                                <p className="mt-1 text-sm font-semibold">
                                    {bestCombo.name}
                                </p>
                                <p className="mt-1 text-xs text-slate-400">
                                    Taille: {bestCombo.size} joueurs ¬∑{' '}
                                    {bestCombo.matches} matchs
                                </p>
                            </div>
                            <div className="flex items-center justify-end gap-6 text-sm">
                                <div className="text-right">
                                    <p className="text-xs text-slate-400">
                                        Points moyens
                                    </p>
                                    <p className="text-xl font-semibold text-emerald-300">
                                        {bestCombo.avgPoints.toFixed(2)}
                                    </p>
                                </div>
                                <div className="text-right">
                                    <p className="text-xs text-slate-400">
                                        Score final moyen
                                    </p>
                                    <p className="text-xl font-semibold text-sky-300">
                                        {bestCombo.avgScoreFinal.toFixed(1)}
                                    </p>
                                </div>
                            </div>
                        </div>
                    )}

                    <div className="flex flex-wrap gap-3 rounded-xl bg-slate-900/60 p-4">
                        <div className="flex flex-col text-sm text-slate-200">
                            <label className="mb-1 text-xs text-slate-400">
                                Matchs minimum
                            </label>
                            <input
                                type="number"
                                min="1"
                                className="w-24 rounded-md border border-slate-700 bg-slate-900 px-2 py-1 text-xs"
                                value={minMatches}
                                onChange={e =>
                                    setMinMatches(
                                        Number.isNaN(
                                            parseInt(e.target.value, 10)
                                        )
                                            ? 1
                                            : parseInt(e.target.value, 10)
                                    )
                                }
                            />
                        </div>
                        <div className="flex flex-col text-sm text-slate-200">
                            <label className="mb-1 text-xs text-slate-400">
                                Filtrer par joueur
                            </label>
                            <input
                                type="text"
                                className="w-52 rounded-md border border-slate-700 bg-slate-900 px-2 py-1 text-xs"
                                placeholder="Ex: Tagliafico, Fofana..."
                                value={playerFilter}
                                onChange={e =>
                                    setPlayerFilter(e.target.value)
                                }
                            />
                        </div>
                        <div className="flex flex-col text-sm text-slate-200">
                            <label className="mb-1 text-xs text-slate-400">
                                Taille de combinaison
                            </label>
                            <select
                                className="rounded-md border border-slate-700 bg-slate-900 px-2 py-1 text-xs"
                                value={sizeFilter}
                                onChange={e => setSizeFilter(e.target.value)}
                            >
                                <option value="all">Toutes</option>
                                {availableSizes.map(size => (
                                    <option key={size} value={String(size)}>
                                        {size} joueurs
                                    </option>
                                ))}
                            </select>
                        </div>
                        <div className="flex flex-col text-sm text-slate-200">
                            <label className="mb-1 text-xs text-slate-400">
                                Tri
                            </label>
                            <select
                                className="rounded-md border border-slate-700 bg-slate-900 px-2 py-1 text-xs"
                                value={sortBy}
                                onChange={e => setSortBy(e.target.value)}
                            >
                                <option value="points_desc">
                                    Points moyens d√©croissants
                                </option>
                                <option value="score_desc">
                                    Score final moyen d√©croissant
                                </option>
                                <option value="matches_desc">
                                    Matchs jou√©s d√©croissants
                                </option>
                            </select>
                        </div>
                    </div>

                    <div className="table-container">
                        <table className="w-full text-left text-sm">
                            <thead>
                                <tr className="border-b border-slate-800 text-xs text-slate-400">
                                    <th className="px-3 py-2">
                                        Combinaison
                                    </th>
                                    <th className="px-3 py-2 text-center">
                                        Taille
                                    </th>
                                    <th className="px-3 py-2 text-center">
                                        Matchs
                                    </th>
                                    <th className="px-3 py-2 text-center">
                                        Points moyens
                                    </th>
                                    <th className="px-3 py-2 text-center">
                                        Score final moyen
                                    </th>
                                </tr>
                            </thead>
                            <tbody>
                                {displayed.map(combo => (
                                    <tr
                                        key={combo.name}
                                        className="border-b border-slate-800/60 align-middle"
                                    >
                                        <td className="px-3 py-2">
                                            {combo.name}
                                        </td>
                                        <td className="px-3 py-2 text-center">
                                            {combo.size}
                                        </td>
                                        <td className="px-3 py-2 text-center">
                                            {combo.matches}
                                        </td>
                                        <td className="px-3 py-2">
                                            <div className="flex items-center justify-center gap-2">
                                                <span>
                                                    {combo.avgPoints.toFixed(2)}
                                                </span>
                                                {maxAvgPoints > 0 && (
                                                    <div className="h-1.5 w-24 overflow-hidden rounded-full bg-slate-800">
                                                        <div
                                                            className="h-full rounded-full bg-emerald-500"
                                                            style={{
                                                                width: `${Math.min(
                                                                    (combo.avgPoints /
                                                                        maxAvgPoints) *
                                                                        100,
                                                                    100
                                                                )}%`
                                                            }}
                                                        />
                                                    </div>
                                                )}
                                            </div>
                                        </td>
                                        <td className="px-3 py-2 text-center">
                                            {combo.avgScoreFinal.toFixed(1)}
                                        </td>
                                    </tr>
                                ))}
                                {displayed.length === 0 && (
                                    <tr>
                                        <td
                                            colSpan="5"
                                            className="px-3 py-4 text-center text-sm text-slate-400"
                                        >
                                            Aucune combinaison ne correspond
                                            aux filtres.
                                        </td>
                                    </tr>
                                )}
                            </tbody>
                        </table>
                    </div>
                </div>
            );
        }

        function StandingsReactSummary() {
            const { loading, error, rows } = useCsvData(
                'data/processed/league1_standings_home_away.csv'
            );

            if (loading) {
                return (
                    <div className="mb-6 rounded-2xl border border-slate-700 bg-slate-900/80 px-6 py-4 text-slate-100">
                        Synth√®se du classement en cours de chargement...
                    </div>
                );
            }

            if (error) {
                return (
                    <div className="mb-6 rounded-2xl border border-red-500/60 bg-red-900/40 px-6 py-4 text-sm text-red-100">
                        Erreur lors du chargement du classement: {error}
                    </div>
                );
            }

            const teams = (rows || []).filter(
                t =>
                    t.team &&
                    !t.team
                        .toLowerCase()
                        .includes('choc des olympiques')
            );

            if (!teams.length) {
                return (
                    <div className="mb-6 rounded-2xl border border-slate-700 bg-slate-900/80 px-6 py-4 text-slate-100">
                        Donn√©es de classement indisponibles.
                    </div>
                );
            }

            const lyonExact = teams.find(t => t.team === 'Lyon');
            const lyonFallback = teams.find(t =>
                t.team.toLowerCase().includes('lyon')
            );
            const lyon = lyonExact || lyonFallback || null;

            const sortedByRank = [...teams].sort(
                (a, b) =>
                    (parseInt(a.rank || '999', 10) || 999) -
                    (parseInt(b.rank || '999', 10) || 999)
            );

            const leader = sortedByRank[0];

            const lyonRank = lyon
                ? parseInt(lyon.rank || '0', 10) || 0
                : null;
            const lyonPoints = lyon
                ? parseInt(lyon.points || '0', 10) || 0
                : 0;
            const lyonPointsPerMatch = lyon
                ? parseFloat(lyon.points_per_match || '0') || 0
                : 0;
            const lyonWinRate = lyon
                ? parseFloat(lyon.win_rate || '0') || 0
                : 0;
            const lyonGoalsForPerMatch = lyon
                ? parseFloat(lyon.goals_for_per_match || '0') || 0
                : 0;
            const lyonGoalsAgainstPerMatch = lyon
                ? parseFloat(lyon.goals_against_per_match || '0') || 0
                : 0;

            const lyonHomePointsPerMatch = lyon
                ? parseFloat(lyon.home_points_per_match || '0') || 0
                : 0;
            const lyonAwayPointsPerMatch = lyon
                ? parseFloat(lyon.away_points_per_match || '0') || 0
                : 0;

            const leaderPoints = leader
                ? parseInt(leader.points || '0', 10) || 0
                : 0;
            const leaderPointsPerMatch = leader
                ? parseFloat(leader.points_per_match || '0') || 0
                : 0;

            const pointsGap =
                lyon && leader ? leaderPoints - lyonPoints : 0;
            const rankGap =
                lyonRank && leader ? lyonRank - (parseInt(leader.rank || '1', 10) || 1) : 0;

            const maxPointsPerMatchInLeague = teams.reduce(
                (max, t) => {
                    const v =
                        parseFloat(t.points_per_match || '0') || 0;
                    return v > max ? v : max;
                },
                0
            );

            const displayTeamName = lyon ? lyon.team : 'Lyon';

            const topThree = sortedByRank.slice(0, 3);

            return (
                <div className="mb-6 space-y-4 rounded-2xl border border-slate-700 bg-slate-900/80 p-6 text-slate-100">
                    <div className="flex flex-col gap-4 md:flex-row md:items-baseline md:justify-between">
                        <div>
                            <p className="text-xs uppercase tracking-wide text-slate-400">
                                Synth√®se Ligue 1
                            </p>
                            <h3 className="text-lg font-semibold">
                                Position actuelle de {displayTeamName}
                            </h3>
                            {lyonRank && (
                                <p className="mt-1 text-xs text-slate-400">
                                    {displayTeamName} est {lyonRank}
                                    e sur {teams.length} √©quipes.
                                </p>
                            )}
                        </div>
                        {leader && (
                            <div className="text-right text-xs text-slate-400">
                                <p>Leader actuel: {leader.team}</p>
                                <p>
                                    {leaderPoints} pts ¬∑{' '}
                                    {leaderPointsPerMatch.toFixed(2)} pts/m
                                </p>
                            </div>
                        )}
                    </div>

                    <div className="grid gap-4 md:grid-cols-3">
                        <div className="space-y-3 rounded-xl bg-slate-900/70 p-4">
                            <p className="text-xs font-medium uppercase tracking-wide text-slate-400">
                                Global
                            </p>
                            <p className="text-3xl font-semibold">
                                {lyonPoints} pts
                            </p>
                            <p className="text-xs text-slate-400">
                                {lyonPointsPerMatch.toFixed(2)} pts/match ¬∑{' '}
                                {lyonWinRate.toFixed(1)}% victoires
                            </p>
                            <div className="mt-3 space-y-2 text-xs text-slate-400">
                                <div className="flex items-center justify-between">
                                    <span>Attaque</span>
                                    <span>
                                        {lyonGoalsForPerMatch.toFixed(2)} buts/m
                                    </span>
                                </div>
                                <div className="h-1.5 w-full overflow-hidden rounded-full bg-slate-800">
                                    <div
                                        className="h-full rounded-full bg-emerald-500"
                                        style={{
                                            width: `${Math.min(
                                                (lyonGoalsForPerMatch / 3) *
                                                    100,
                                                100
                                            )}%`
                                        }}
                                    />
                                </div>
                                <div className="flex items-center justify-between">
                                    <span>D√©fense</span>
                                    <span>
                                        {lyonGoalsAgainstPerMatch.toFixed(2)} buts/m
                                    </span>
                                </div>
                                <div className="h-1.5 w-full overflow-hidden rounded-full bg-slate-800">
                                    <div
                                        className="h-full rounded-full bg-rose-500"
                                        style={{
                                            width: `${Math.min(
                                                (lyonGoalsAgainstPerMatch /
                                                    3) *
                                                    100,
                                                100
                                            )}%`
                                        }}
                                    />
                                </div>
                            </div>
                        </div>

                        <div className="space-y-3 rounded-xl bg-slate-900/70 p-4">
                            <p className="text-xs font-medium uppercase tracking-wide text-slate-400">
                                Domicile vs ext√©rieur
                            </p>
                            <div className="space-y-3">
                                <div>
                                    <div className="flex items-center justify-between text-xs text-slate-400">
                                        <span>Domicile</span>
                                        <span>
                                            {lyonHomePointsPerMatch.toFixed(2)} pts/m
                                        </span>
                                    </div>
                                    <div className="mt-1 h-1.5 w-full overflow-hidden rounded-full bg-slate-800">
                                        <div
                                            className="h-full rounded-full bg-sky-500"
                                            style={{
                                                width: `${maxPointsPerMatchInLeague > 0 ? Math.min(
                                                    (lyonHomePointsPerMatch /
                                                        maxPointsPerMatchInLeague) *
                                                        100,
                                                    100
                                                ) : 0}%`
                                            }}
                                        />
                                    </div>
                                </div>
                                <div>
                                    <div className="flex items-center justify-between text-xs text-slate-400">
                                        <span>Ext√©rieur</span>
                                        <span>
                                            {lyonAwayPointsPerMatch.toFixed(2)} pts/m
                                        </span>
                                    </div>
                                    <div className="mt-1 h-1.5 w-full overflow-hidden rounded-full bg-slate-800">
                                        <div
                                            className="h-full rounded-full bg-amber-400"
                                            style={{
                                                width: `${maxPointsPerMatchInLeague > 0 ? Math.min(
                                                    (lyonAwayPointsPerMatch /
                                                        maxPointsPerMatchInLeague) *
                                                        100,
                                                    100
                                                ) : 0}%`
                                            }}
                                        />
                                    </div>
                                </div>
                            </div>
                            {rankGap !== null && lyonRank && (
                                <p className="mt-3 text-xs text-slate-400">
                                    √âcart avec le leader:{' '}
                                    {pointsGap >= 0
                                        ? `${pointsGap} pts`
                                        : `${-pointsGap} pts d'avance`}{' '}
                                    ¬∑ {rankGap > 0 ? `${rankGap} places` : 'Leader'}
                                </p>
                            )}
                        </div>

                        <div className="space-y-3 rounded-xl bg-slate-900/70 p-4">
                            <p className="text-xs font-medium uppercase tracking-wide text-slate-400">
                                Top 3 du championnat
                            </p>
                            <ul className="space-y-2 text-sm">
                                {topThree.map(team => (
                                    <li
                                        key={team.team}
                                        className="flex items-center justify-between rounded-lg bg-slate-900/80 px-3 py-2"
                                    >
                                        <div>
                                            <p className="font-medium">
                                                {team.rank}. {team.team}
                                            </p>
                                            <p className="text-xs text-slate-400">
                                                {parseInt(team.points || '0', 10) ||
                                                    0}{' '}
                                                pts ¬∑{' '}
                                                {(
                                                    parseFloat(
                                                        team.points_per_match ||
                                                            '0'
                                                    ) || 0
                                                ).toFixed(2)}{' '}
                                                pts/m
                                            </p>
                                        </div>
                                    </li>
                                ))}
                            </ul>
                        </div>
                    </div>
                </div>
            );
        }

        const mainRoot = document.getElementById('react-root');
        if (mainRoot && window.ReactDOM && ReactDOM.createRoot) {
            ReactDOM.createRoot(mainRoot).render(<MatchAnalysisDashboard />);
        }

        const matchesRoot = document.getElementById('matches-react-root');
        if (matchesRoot && window.ReactDOM && ReactDOM.createRoot) {
            ReactDOM.createRoot(matchesRoot).render(<MatchesReactTableByRound />);
        }

        const mercatoRoot = document.getElementById('mercato-react-root');
        if (mercatoRoot && window.ReactDOM && ReactDOM.createRoot) {
            ReactDOM.createRoot(mercatoRoot).render(<MercatoReactView />);
        }

        const newsRoot = document.getElementById('news-react-root');
        if (newsRoot && window.ReactDOM && ReactDOM.createRoot) {
            ReactDOM.createRoot(newsRoot).render(
                <NewsReactView />
            );
        }

        const combosRoot = document.getElementById('combos-react-root');
        if (combosRoot && window.ReactDOM && ReactDOM.createRoot) {
            ReactDOM.createRoot(combosRoot).render(
                <CombosAdvancedReactView />
            );
        }

        const standingsRoot = document.getElementById('standings-react-root');
        if (standingsRoot && window.ReactDOM && ReactDOM.createRoot) {
            ReactDOM.createRoot(standingsRoot).render(
                <StandingsReactSummary />
            );
        }
    </script>
</body>
</html>
